{
  "extract_id": "extract_b47193c1938d4db98270bd0154b172a7",
  "results": [
    {
      "url": "https://docs.snowflake.com/en/user-guide/cost-exploring-compute",
      "title": "Exploring compute cost | Snowflake Documentation",
      "publish_date": null,
      "excerpts": [
        "Guides Cost & Billing Visibility Exploring cost Exploring compute cost\n\n# Exploring compute cost \u00b6\n\nTotal compute cost consists of the overall use of:\n\n* Virtual warehouses (user-managed compute resources)\n* Serverless features such as Automatic Clustering and Snowpipe that use Snowflake-managed compute resources\n* Cloud services layer of the Snowflake architecture\n* vCPU usage for Openflow BYOC cost and scaling considerations and Openflow Snowflake Deployment cost and scaling considerations .\n  See Openflow components for more information about Openflow components including runtimes.\n\nThis topic describes how to gain insight into historical compute costs using Snowsight , or by writing queries against views in\nthe ACCOUNT\\_USAGE and ORGANIZATION\\_USAGE schemas.\nSnowsight allows you to quickly and easily obtain information about cost from a visual dashboard. Queries against the usage views\nallow you to drill down into cost data and can help generate custom reports and dashboards.\n\nIf you need more information about how compute costs are incurred, refer to Understanding compute cost .\n\nNote\n\nThe cloud services layer consumes credits, but not all of those credits are actually billed. Usage for cloud services is charged only if\nthe daily consumption of cloud services exceeds 10% of the daily usage of virtual warehouses. Snowsight and a majority of views\nshow the total number of credits consumed by warehouses, serverless features, and cloud services without accounting for this daily\nadjustment to cloud services.\n\nTo determine how many credits were actually billed for compute costs, run queries against the METERING\\_DAILY\\_HISTORY view .\n\n## Viewing credit usage \u00b6\n\nAll compute resources (virtual warehouses, serverless, cloud services) consume Snowflake credits. Users can use Snowsight to\nview the overall cost of compute usage for any given day, week, or month.\n\nTo explore compute cost:\n\n2. Switch to a role with access to cost and usage data .\n3. In the navigation menu, select Admin \u00bb Cost management .\n4. Select a warehouse to use to view the usage data. Snowflake recommends using an XS warehouse for this purpose.\n5. Select Consumption .\n6. Select Compute from the Usage Type drop-down.\n\nFor usage notes related to the Consumption page, see Usage notes .\n\n### Filter by tag \u00b6\n\nYou can use tags to attribute the cost of using resources to a logical\nunit within your organization. A tag is a Snowflake object that can have one or more values associated with it. A user with the\nappropriate privileges applies a tag/value pair to each resource that is used by a cost center or other logical unit (e.g. the Development\nenvironment, a business unit, or business line). Once resources have been tagged, you can isolate costs based on a\nspecific tag/value pair, allowing you to attribute this cost to a specific logical unit.\n\nTo filter the Consumption dashboard to show costs associated with a specific tag/value combination:\n\n2. Switch to a role with access to cost and usage data .\n3. In the navigation menu, select Admin \u00bb Cost management .\n4. Select a warehouse to use to view the usage data. Snowflake recommends using an XS warehouse for this purpose.\n5. Select Consumption .\n6. Select Compute from the Usage Type drop-down.\n7. From the Tags drop-down, select the tag.\n8. Select the value from the list of the tag\u2019s values.\n9. Select Apply .\n\nFor example, you can use the drop-down to select the `COST_CENTER` tag and the `SALES` value to show usage associated with resources\ntagged with `COST_CENTER = SALES` while excluding all other usage from the dashboard.\n\nYou can also display all resources with a tag regardless of their tag value. Use the drop down to select a\ntag, then choose All instead of a specific value.\n\n### View consumption by type, service, or resource \u00b6\n\nWhen viewing the bar graph that displays compute history, you can filter the data By Type , By Service or By Resource .\n\n> By Type :\n>     Separates resource consumption into compute (virtual warehouses and serverless resources) and cloud services. For the purpose\n> of this filter, cloud services is separated out from the other types of compute resources.\n> By Service :\n>     Separates resource consumption into warehouse consumption and consumption by each serverless feature. For example,\n> WAREHOUSE\\_METERING represents credits consumed by warehouses while PIPE represents credits consumed by the serverless Snowpipe feature.\n> Cloud services compute is included in warehouse consumption.\n> By Resource :\n>     Separates resource consumption by the Snowflake object that consumed credits. For example, each warehouse is represented,\n> as is every table that incurred serverless costs.\n> \n>\n\n## Querying data for compute cost \u00b6\n\nSnowflake provides two schemas, ORGANIZATION\\_USAGE and ACCOUNT\\_USAGE , that contain data related to usage and cost. The ORGANIZATION\\_USAGE schema provides\ncost information for all of the accounts in the organization while the ACCOUNT\\_USAGE schema provides similar information for a single\naccount. Views in these schemas provide granular, analytics-ready usage data to build custom reports or dashboards.\n\nMost views in the ORGANIZATION\\_USAGE and ACCOUNT\\_USAGE schemas contain the cost of compute resources in terms of credits consumed. To explore compute cost in currency, rather than credits, write queries against the USAGE\\_IN\\_CURRENCY\\_DAILY view . This view converts credits consumed into cost in currency using the daily\nprice of a credit.\n\n### General cost views \u00b6\n\nThe following views contain information related to the compute costs of all Snowflake features. You can focus on a particular feature by filtering on the `service_type` column.\n\nFor additional views that focus on the cost of a specific feature, see Feature-specific cost views .\n\n|View |Compute resource |Description |Schema |\n| --- | --- | --- | --- |\n|METERING\\_DAILY\\_HISTORY |Warehouses\n\nServerless\n\nCloud Services\n\nOpenflow runtimes |Credits consumed by all compute resources (warehouses, serverless, cloud services and Openflow) in a given day.\n\nCan be used to determine whether cloud services compute costs were actually billed for a specific day (that is, cloud services credit\nconsumption exceeded 10% of warehouse consumption). |ORGANIZATION\\_USAGE ACCOUNT\\_USAGE |\n|METERING\\_HISTORY |Warehouses\n\nServerless\n\nCloud Services\n\nOpenflow runtimes |Credits consumed by warehouses, cloud services, serverless, and Openflow features on an hourly basis. To see how many credits an individual\nwarehouse is consuming, query the WAREHOUSE\\_METERING\\_HISTORY view. |ACCOUNT\\_USAGE |\n|USAGE\\_IN\\_CURRENCY\\_DAILY |Warehouses\n\nServerless\n\nCloud Services |Daily credit consumption by all compute resources along with the cost of that usage in the organization\u2019s currency. |ORGANIZATION\\_USAGE |\n\n### Feature-specific cost views \u00b6\n\nThe following views that are dedicated to the usage and cost information for a specific feature.\n\n|View |Compute resource |Description |\n| --- | --- | --- |\n|APPLICATION\\_DAILY\\_USAGE\\_HISTORY |Warehouses\n\nServerless\n\nCloud Services |Daily credit usage for Snowflake Native Apps in an account within the last 365 days. |\n|ARCHIVE\\_STORAGE\\_DATA\\_\nRETRIEVAL\\_USAGE\\_HISTORY |Serverless |Bytes retrieved from archive storage for storage lifecycle policies.\nSee Billing for storage lifecycle policies for more information. |\n|AUTOMATIC\\_CLUSTERING\\_HISTORY |Serverless |Credits consumed by automatic clustering. |\n|CATALOG\\_LINKED\\_DATABASE\\_\nUSAGE\\_HISTORY |Serverless |Credits consumed by catalog-linked databases. |\n|CORTEX\\_AGENT\\_USAGE\\_HISTORY |Serverless |Credits consumed by Cortex Agents. |\n|CORTEX\\_ANALYST\\_\nUSAGE\\_HISTORY |Serverless |Credits consumed by Cortex Analyst. |\n|CORTEX\\_FINE\\_TUNING\\_\nUSAGE\\_HISTORY |Serverless |Credits consumed for Cortex Fine-tuning. |\n|CORTEX\\_FUNCTIONS\\_\nQUERY\\_USAGE\\_HISTORY |Serverless |Credits consumed to run queries that use Cortex LLM functions. |\n|CORTEX\\_FUNCTIONS\\_\nDOCUMENT\\_PROCESSING\\_USAGE\\_HISTORY |Serverless |Credits consumed to process documents with Document AI. |\n|CORTEX\\_FUNCTIONS\\_\nUSAGE\\_HISTORY |Serverless |Credits consumed to call Cortex LLM functions. |\n|CORTEX\\_REST\\_API\\_\nUSAGE\\_HISTORY |Serverless |Credits consumed by Cortex REST API calls. |\n|CORTEX\\_SEARCH\\_DAILY\\_\nUSAGE\\_HISTORY |Serverless |Daily credits consumed for Cortex Search for serving and text embeddings |\n|CORTEX\\_SEARCH\\_SERVING\\_\nUSAGE\\_HISTORY |Serverless |Credits consumed for Cortex Search serving |\n|DATA\\_QUALITY\\_MONITORING\\_\nUSAGE\\_HISTORY |Serverless |Credits consumed to call scheduled DMFs and ingest results into an event table. |\n|DATABASE\\_REPLICATION\\_USAGE\\_\nHISTORY |Serverless |Credits consumed for database replication. |\n|DOCUMENT\\_AI\\_\nUSAGE\\_HISTORY |Serverless |Credits consumed by Document AI. |\n|HYBRID\\_TABLE\\_USAGE\\_HISTORY |Serverless |Credits consumed for Hybrid Table Requests resources. |\n|LISTING\\_AUTO\\_FULFILLMENT\\_\nREFRESH\\_DAILY |Warehouses |Credits used to refresh data fulfilled to other regions by Cross-Cloud Auto-Fulfillment. |\n|LISTING\\_AUTO\\_FULFILLMENT\\_\nUSAGE\\_HISTORY |Warehouses |Estimated usage associated with fulfilling data products to other regions by using Cross-Cloud Auto-Fulfillment.\nRefer to the SERVICE\\_TYPE of REPLICATION. |\n|MATERIALIZED\\_VIEW\\_REFRESH\\_\nHISTORY |Serverless |Credits consumed the refreshing of materialized views. |\n|OPENFLOW\\_USAGE\\_HISTORY |Openflow |Credits consumed by Openflow runtimes.\nThis view is available in the ACCOUNT\\_USAGE schema only. |\n|PIPE\\_USAGE\\_HISTORY |Serverless |Credits consumed by Snowpipe. |\n|QUERY\\_ACCELERATION\\_HISTORY |Serverless |Credits consumed by the query acceleration service. |\n|QUERY\\_ATTRIBUTION\\_HISTORY |Warehouses |Credits consumed per query for warehouse usage. |\n|REPLICATION\\_USAGE\\_HISTORY |Serverless |Credits consumed and number of bytes transferred during database replication. If possible, use the DATABASE\\_REPLICATION\\_USAGE\\_HISTORY view instead. |\n|REPLICATION\\_GROUP\\_USAGE\\_\nHISTORY |Serverless |Credits consumed and number of bytes transferred during replication for a specific replication group. |\n|SEARCH\\_OPTIMIZATION\\_HISTORY |Serverless |Credits consumed by the search optimization service. |\n|SERVERLESS\\_ALERT\\_HISTORY |Serverless |Credits consumed by serverless alerts. |\n|SERVERLESS\\_TASK\\_HISTORY |Serverless |Credits consumed by serverless tasks. |\n|SNOWFLAKE\\_INTELLIGENCE\\_USAGE\\_HISTORY |Serverless |Credits consumed by Snowflake Intelligence. |\n|SNOWPIPE\\_STREAMING\\_FILE\\_\nMIGRATION\\_HISTORY |Serverless |Credits consumed by Snowpipe Streaming compute (does not include client costs). |\n|WAREHOUSE\\_METERING\\_HISTORY |Warehouses\n\nCloud Services |Hourly credit usage of each warehouse, including the cloud services cost associated with using the warehouse. |\n\nNote\n\nThe views and table functions of the Snowflake Information Schema also provide usage data related to cost. Though\nthe ACCOUNT\\_USAGE schema is preferred, the Information Schema can be faster in some circumstances.\n\n### Example queries \u00b6\n\nThe following queries drill-down into data in ACCOUNT\\_USAGE views to gain insight into compute costs.\n\nNote\n\nQueries executed against views in the Account Usage schema can be modified to gain insight into cost for the entire organization by\nusing the corresponding view in the Organization Usage schema. For example, both schemas include a WAREHOUSE\\_METERING\\_HISTORY view.\n\nClick the name of a query below to see the full SQL example.\n\nCompute for Warehouses :\n    * Query: Average hour-by-hour Snowflake spend (across all warehouses) over the past m days\n* Query: Credit consumption by warehouse over specific time period\n* Query: Warehouse usage over m-day average\n* Query: Warehouse cost attribution by query tag .\n* Query: Warehouse cost attribution by user .\n\nCompute for Cloud Services :\n    * Query: Billed cloud services\n* Query: Total cloud services cost by type of query\n* Query: Cloud services cost for queries of a given type\n* Query: Warehouses with high cloud services usage\n* Query: Cloud services cost sorted by portion of query time\n\nCompute for Automatic Clustering :\n    * Query: Automatic Clustering cost history (by day, by object)\n* Query: Automatic Clustering History & m-day average\n\nCompute for Search Optimization :\n    * Query: Search Optimization cost history (by day, by object)\n* Query: Search Optimization History & m-day average\n\nCompute for Materialized Views :\n    * Query: Materialized Views cost history (by day, by object)\n* Query: Materialized Views History & m-day average\n\nCompute for Query Acceleration Service :\n    * Query: Query Acceleration Service cost by warehouse\n\nCompute for Snowpipe :\n    * Query: Cumulative usage of data ingest (Snowpipe and \u201cCopy\u201d)\n* Query: Snowpipe cost history (by day, by object)\n* Query: Snowpipe History & m-day average\n\nCompute and client costs for Snowpipe Streaming :\n    * Query: Snowpipe Streaming cost\n\nCompute for Serverless Alerts :\n    * Query: Total serverless alert cost\n\nCompute for Serverless Tasks :\n    * Query: Total serverless task cost\n\nCompute for Replication :\n    * Query: Account replication cost\n* Query: Database replication cost history (by day, by object)\n* Query: Database replication History & m-day average\n\nCompute for Partner Tools :\n    * Query: Credit consumption by partner tools\n\nCompute for Hybrid Tables :\n    * Query: Credit consumption by hybrid tables\n\nCompute for Cortex Agents :\n    * Query: Credit consumption by Cortex Agents\n\nCompute for Cortex Analyst :\n    * Query: Credit consumption by Cortex Analyst\n\nCompute for Cortex Fine-tuning :\n    * Query: Credit consumption by Cortex Fine-tuning\n\nCompute for Cortex functions :\n    * Query: Credit consumption by Cortex functions\n* Query: Credit consumption by Cortex functions query\n\nCompute for Cortex Search :\n    * Query: Daily credit consumption by Cortex Search\n* Query: Credit consumption by Cortex Search serving\n\nCompute for Document AI :\n    * Query: Credit consumption by Document AI\n\nCompute for Snowflake Intelligence :\n    * Query: Credit consumption by Snowflake Intelligence\n\nCompute for Snowflake Notebooks :\n    * Query: Hourly credit consumption by notebooks\n* Query: Cost to run a specific notebook\n* Query: Total compute pool cost per notebook\n* Query: Identify users who ran a specific notebook\n\n#### Compute for warehouses \u00b6\n\nQuery: Average hour-by-hour Snowflake spend (across all warehouses) over the past m days\n    This query shows the total credit consumption on an hourly basis to help understand consumption trends (peaks, valleys) over the past m\ndays. This helps identify times of day when there are spikes in consumption.\n\n```\nSELECT start_time , \n  warehouse_name , \n  credits_used_compute \n FROM snowflake . account_usage . warehouse_metering_history \n WHERE start_time >= DATEADD ( day , - m , CURRENT_TIMESTAMP ()) \n  AND warehouse_id > 0  -- Skip pseudo-VWs such as \"CLOUD_SERVICES_ONLY\" \n ORDER BY 1 DESC , 2 ; \n\n -- by hour \n SELECT DATE_PART ( 'HOUR' , start_time ) AS start_hour , \n  warehouse_name , \n  AVG ( credits_used_compute ) AS credits_used_compute_avg \n FROM snowflake . account_usage . warehouse_metering_history \n WHERE start_time >= DATEADD ( day , - m , CURRENT_TIMESTAMP ()) \n  AND warehouse_id > 0  -- Skip pseudo-VWs such as \"CLOUD_SERVICES_ONLY\" \n GROUP BY 1 , 2 \n ORDER BY 1 , 2 ;\n```\n\nCopy\n\nQuery: Credit consumption by warehouse over specific time period\n    This query shows the total credit consumption for each warehouse over a specific time period. This helps identify warehouses that are\nconsuming more credits than others and specific warehouses that are consuming more credits than anticipated.\n\n```\n-- Credits used (all time = past year) \n SELECT warehouse_name , \n  SUM ( credits_used_compute ) AS credits_used_compute_sum \n FROM snowflake . account_usage . warehouse_metering_history \n GROUP BY 1 \n ORDER BY 2 DESC ; \n\n -- Credits used (past N days/weeks/months) \n SELECT warehouse_name , \n  SUM ( credits_used_compute ) AS credits_used_compute_sum \n FROM snowflake . account_usage . warehouse_metering_history \n WHERE start_time >= DATEADD ( day , - m , CURRENT_TIMESTAMP ()) \n GROUP BY 1 \n ORDER BY 2 DESC ;\n```\n\nCopy\n\nQuery: Warehouse usage over m-day average\n    This query returns the daily average credit consumption grouped by week and warehouse. It can be used to identify anomalies in credit\nconsumption for warehouses across weeks from the past year.\n\n```\nWITH cte_date_wh AS ( \n  SELECT TO_DATE ( start_time ) AS start_date , \n    warehouse_name , \n    SUM ( credits_used ) AS credits_used_date_wh \n  FROM snowflake . account_usage . warehouse_metering_history \n  GROUP BY start_date , warehouse_name \n ) \n\n SELECT start_date , \n  warehouse_name , \n  credits_used_date_wh , \n  AVG ( credits_used_date_wh ) OVER ( PARTITION BY warehouse_name ORDER BY start_date ROWS m PRECEDING ) AS credits_used_m_day_avg , \n  100 . 0 *(( credits_used_date_wh / credits_used_m_day_avg ) - 1 ) AS pct_over_to_m_day_average \n FROM cte_date_wh \n  QUALIFY credits_used_date_wh > 100  -- Minimum N=100 credits \n    AND pct_over_to_m_day_average >= 0 . 5  -- Minimum 50% increase over past m day average \n ORDER BY pct_over_to_m_day_average DESC ;\n```\n\nCopy\n\n#### Compute for cloud services \u00b6\n\nQuery: Billed cloud services\n    Usage for cloud services is billed only if the daily consumption of cloud\nservices exceeds 10% of the daily usage of virtual warehouses. This query returns how much of cloud services consumption was actually\nbilled for a particular day, ordered by the highest billed amount.\n\n```\nSELECT \n    usage_date , \n    credits_used_cloud_services , \n    credits_adjustment_cloud_services , \n    credits_used_cloud_services + credits_adjustment_cloud_services AS billed_cloud_services \n FROM snowflake . account_usage . metering_daily_history \n WHERE usage_date >= DATEADD ( month ,- 1 , CURRENT_TIMESTAMP ()) \n    AND credits_used_cloud_services > 0 \n ORDER BY 4 DESC ;\n```\n\nCopy\n\nQuery: Total cloud services cost by type of query\n    This query returns the total credits consumed for cloud services by a particular type of query.\n\n```\nSELECT query_type , \n  SUM ( credits_used_cloud_services ) AS cs_credits , \n  COUNT ( 1 ) num_queries \n FROM snowflake . account_usage . query_history \n WHERE true \n  AND start_time >= TIMESTAMPADD ( day , - 1 , CURRENT_TIMESTAMP ) \n GROUP BY 1 \n ORDER BY 2 DESC \n LIMIT 10 ;\n```\n\nCopy\n\nQuery: Cloud services cost for queries of a given type\n    This query returns the total credits consumed for cloud services by all queries of a specific type. Replace `'COPY'` if you want to focus on a different type of query and `day` if you want to explore a longer or shorter period of time.\n\n```\nSELECT * \n FROM snowflake . account_usage . query_history \n WHERE true \n  AND start_time >= TIMESTAMPADD ( day , - 1 , CURRENT_TIMESTAMP ) \n  AND query_type = 'COPY' \n ORDER BY credits_used_cloud_services DESC \n LIMIT 10 ;\n```\n\nCopy\n\nQuery: Warehouses with high cloud services usage\n    This query shows the warehouses that are not using enough warehouse time to cover the cloud services portion of compute. This provides a\nlaunching point for additional investigation by isolating warehouses with a high ratio of cloud service use (>10% of overall credits).\nInvestigation candidates include issues around cloning, listing files in S3, partner tools, setting session parameters, etc.\n\n```\nSELECT \n  warehouse_name , \n  SUM ( credits_used ) AS credits_used , \n  SUM ( credits_used_cloud_services ) AS credits_used_cloud_services , \n  SUM ( credits_used_cloud_services )/ SUM ( credits_used ) AS percent_cloud_services \n FROM snowflake . account_usage . warehouse_metering_history \n WHERE TO_DATE ( start_time ) >= DATEADD ( month ,- 1 , CURRENT_TIMESTAMP ()) \n    AND credits_used_cloud_services > 0 \n GROUP BY 1 \n ORDER BY 4 DESC ;\n```\n\nCopy\n\nQuery: Cloud services usage sorted by portion of query time\n    This query returns all queries run within the last minute and sorts them by parts of total query execution time (e.g. compilation time vs. queue time).\n\n```\nSELECT * \n FROM snowflake . account_usage . query_history \n WHERE true \n  AND start_time >= TIMESTAMPADD ( minute , - 60 , CURRENT_TIMESTAMP ) \n ORDER BY compilation_time DESC , \n  execution_time DESC , \n  list_external_files_time DESC , \n  queued_overload_time DESC , \n  credits_used_cloud_services DESC \n LIMIT 10 ;\n```\n\nCopy\n\n#### Compute for Automatic Clustering \u00b6\n\nQuery: Automatic Clustering cost history (by day, by object)\n    This query provides a list of tables with Automatic Clustering and the volume of credits consumed via the service over the last 30 days,\nbroken out by day. Any irregularities in the credit consumption or consistently high consumption are flags for additional investigation.\n\n```\nSELECT TO_DATE ( start_time ) AS date , \n  database_name , \n  schema_name , \n  table_name , \n  SUM ( credits_used ) AS credits_used \n FROM snowflake . account_usage . automatic_clustering_history \n WHERE start_time >= DATEADD ( month ,- 1 , CURRENT_TIMESTAMP ()) \n GROUP BY 1 , 2 , 3 , 4 \n ORDER BY 5 DESC ;\n```\n\nCopy\n\nQuery: Automatic Clustering History & m-day average\n    This query shows the average daily credits consumed by Automatic Clustering grouped by week over the last year. It can help identify\nanomalies in daily averages over the year so you can investigate spikes or unexpected changes in consumption.\n\n```\nWITH credits_by_day AS ( \n  SELECT TO_DATE ( start_time ) AS date , \n    SUM ( credits_used ) AS credits_used \n  FROM snowflake . account_usage . automatic_clustering_history \n  WHERE start_time >= DATEADD ( year ,- 1 , CURRENT_TIMESTAMP ()) \n  GROUP BY 1 \n  ORDER BY 2 DESC \n ) \n\n SELECT DATE_TRUNC ( 'week' , date ), \n      AVG ( credits_used ) AS avg_daily_credits \n FROM credits_by_day \n GROUP BY 1 \n ORDER BY 1 ;\n```\n\nCopy\n\n#### Compute for Search Optimization \u00b6\n\nQuery: Search Optimization cost history (by day, by object)\n    This query provides a full list of tables with Search Optimization and the volume of credits consumed via the service over the last 30\ndays, broken out by day. Any irregularities in the credit consumption or consistently high consumption are flags for additional\ninvestigation.\n\n```\nSELECT TO_DATE ( start_time ) AS date , \n  database_name , \n  schema_name , \n  table_name , \n  SUM ( credits_used ) AS credits_used \n FROM snowflake . account_usage . search_optimization_history \n WHERE start_time >= DATEADD ( month ,- 1 , CURRENT_TIMESTAMP ()) \n GROUP BY 1 , 2 , 3 , 4 \n ORDER BY 5 DESC ;\n```\n\nCopy\n\nQuery: Search Optimization History & m-day average\n    This query shows the average daily credits consumed by Search Optimization grouped by week over the last year. It can help identify\nanomalies in daily averages over the year so you can investigate spikes or unexpected changes in\nconsumption.\n\n```\nWITH credits_by_day AS ( \n  SELECT TO_DATE ( start_time ) AS date , \n    SUM ( credits_used ) AS credits_used \n  FROM snowflake . account_usage . search_optimization_history \n  WHERE start_time >= DATEADD ( year ,- 1 , CURRENT_TIMESTAMP ()) \n  GROUP BY 1 \n  ORDER BY 2 DESC \n ) \n\n SELECT DATE_TRUNC ( 'week' , date ), \n  AVG ( credits_used ) as avg_daily_credits \n FROM credits_by_day \n GROUP BY 1 \n ORDER BY 1 ;\n```\n\nCopy\n\n#### Compute for Materialized Views \u00b6\n\nQuery: Materialized Views cost history (by day, by object)\n    This query provides a full list of materialized views and the volume of credits consumed via the service over the last 30 days, broken\nout by day. Any irregularities in the credit consumption or consistently high consumption are flags for additional investigation.\n\n```\nSELECT TO_DATE ( start_time ) AS date , \n  database_name , \n  schema_name , \n  table_name , \n  SUM ( credits_used ) AS credits_used \n FROM snowflake . account_usage . materialized_view_refresh_history \n WHERE start_time >= DATEADD ( month ,- 1 , CURRENT_TIMESTAMP ()) \n GROUP BY 1 , 2 , 3 , 4 \n ORDER BY 5 DESC ;\n```\n\nCopy\n\nQuery: Materialized Views History & m-day average\n    This query shows the average daily credits consumed by materialized views grouped by week over the last year. It can help identify\nanomalies in daily averages over the year so you can investigate spikes or unexpected changes in\nconsumption.\n\n```\nWITH credits_by_day AS ( \n  SELECT TO_DATE ( start_time ) AS date , \n    SUM ( credits_used ) AS credits_used \n  FROM snowflake . account_usage . materialized_view_refresh_history \n  WHERE start_time >= DATEADD ( year ,- 1 , CURRENT_TIMESTAMP ()) \n  GROUP BY 1 \n  ORDER BY 2 DESC \n ) \n\n SELECT DATE_TRUNC ( 'week' , date ), \n  AVG ( credits_used ) AS avg_daily_credits \n FROM credits_by_day \n GROUP BY 1 \n ORDER BY 1 ;\n```\n\nCopy\n\n#### Compute for Query Acceleration Service \u00b6\n\nQuery: Query Acceleration Service cost by warehouse\n    This query returns the total number of credits used by each warehouse in your account for the query acceleration service\n(month-to-date):\n\n```\nSELECT warehouse_name , \n       SUM ( credits_used ) AS total_credits_used \n  FROM SNOWFLAKE . ACCOUNT_USAGE . QUERY_ACCELERATION_HISTORY \n  WHERE start_time >= DATE_TRUNC ( month , CURRENT_DATE ) \n  GROUP BY 1 \n  ORDER BY 2 DESC ;\n```\n\nCopy\n\n#### Compute for Snowpipe and Snowpipe Streaming \u00b6\n\nQuery: Cumulative usage of data ingest (Snowpipe and \u201cCopy\u201d)\n    This query returns an aggregated daily summary of all loads for each table in Snowflake showing average file size, total rows, total\nvolume and the ingest method (copy or Snowpipe). If file sizes are too small or big for optimal ingest, additional\ninvestigation/optimization may be required. By mapping the volume to credit consumption, it is possible to determine which tables are\nconsuming more credits per TB loaded.\n\n```\nSELECT TO_DATE ( last_load_time ) AS load_date , \n  status , \n  table_catalog_name AS database_name , \n  table_schema_name AS schema_name , \n  table_name , \n  CASE \n    WHEN pipe_name IS NULL THEN 'COPY' \n    ELSE 'SNOWPIPE' \n  END AS ingest_method , \n  SUM ( row_count ) AS row_count , \n  SUM ( row_parsed ) AS rows_parsed , \n  AVG ( file_size ) AS avg_file_size_bytes , \n  SUM ( file_size ) AS total_file_size_bytes , \n  SUM ( file_size )/ POWER ( 1024 , 1 ) AS total_file_size_kb , \n  SUM ( file_size )/ POWER ( 1024 , 2 ) AS total_file_size_mb , \n  SUM ( file_size )/ POWER ( 1024 , 3 ) AS total_file_size_gb , \n  SUM ( file_size )/ POWER ( 1024 , 4 ) AS total_file_size_tb \n FROM snowflake . account_usage . copy_history \n GROUP BY 1 , 2 , 3 , 4 , 5 , 6 \n ORDER BY 3 , 4 , 5 , 1 , 2 ;\n```\n\nCopy\n\nQuery: Snowpipe cost history (by day, by object)\n    This query provides a full list of pipes and the volume of credits consumed via the service over the last 30 days, broken out by day.\nAny irregularities in the credit consumption or consistently high consumption are flags for additional investigation.\n\n```\nSELECT TO_DATE ( start_time ) AS date , \n  pipe_name , \n  SUM ( credits_used ) AS credits_used \n FROM snowflake . account_usage . pipe_usage_history \n WHERE start_time >= DATEADD ( month ,- 1 , CURRENT_TIMESTAMP ()) \n GROUP BY 1 , 2 \n ORDER BY 3 DESC ;\n```\n\nCopy\n\nQuery: Snowpipe History & m-day average\n    This query shows the average daily credits consumed by Snowpipe grouped by week over the last year. It can help identify anomalies in\ndaily averages over the year so you can investigate spikes or unexpected changes in consumption.\n\n```\nWITH credits_by_day AS ( \n  SELECT TO_DATE ( start_time ) AS date , \n    SUM ( credits_used ) AS credits_used \n  FROM snowflake . account_usage . pipe_usage_history \n  WHERE start_time >= DATEADD ( year ,- 1 , CURRENT_TIMESTAMP ()) \n  GROUP BY 1 \n  ORDER BY 2 DESC \n ) \n\n SELECT DATE_TRUNC ( 'week' , date ), \n  AVG ( credits_used ) AS avg_daily_credits \n FROM credits_by_day \n GROUP BY 1 \n ORDER BY 1 ;\n```\n\nCopy\n\nQuery: Total Snowpipe Streaming cost\n    This query lists the current credit usage for Snowpipe Streaming, including both Snowpipe Streaming compute and client costs.\n\n```\nSELECT start_time , \n  end_time , \n  SUM ( credits_used ) AS total_credits , \n  name , \n  IFF ( CONTAINS ( name , ':' ), 'streaming client cost' , 'streaming compute cost' ) AS streaming_cost_type \n FROM SNOWFLAKE . ACCOUNT_USAGE . METERING_HISTORY \n WHERE service_type = 'SNOWPIPE_STREAMING' \n GROUP BY ALL ;\n```\n\nCopy\n\n#### Compute for serverless alerts \u00b6\n\nQuery: Total serverless alert cost\n    This query lists the current credit usage for all serverless alerts:\n\n```\nSELECT \n    start_time , \n    end_time , \n    alert_id , \n    alert_name , \n    credits_used , \n    schema_id , \n    schema_name , \n    database_id , \n    database_name \n  FROM SNOWFLAKE . ACCOUNT_USAGE . serverless_alert_history \n  ORDER BY start_time , alert_id ;\n```\n\nCopy\n\n#### Compute for serverless tasks \u00b6\n\nQuery: Total serverless task cost\n    This query lists the current credit usage for all serverless tasks:\n\n```\nSELECT start_time , \n  end_time , \n  task_id , \n  task_name , \n  credits_used , \n  schema_id , \n  schema_name , \n  database_id , \n  database_name \n FROM snowflake . account_usage . serverless_task_history \n ORDER BY start_time , task_id ;\n```\n\nCopy\n\n#### Compute for replication \u00b6\n\nQuery: Account replication cost\n    This query lists the credits used by a replication or failover group for account replication in the current month:\n\n```\nSELECT start_time , \n  end_time , \n  replication_group_name , \n  credits_used , \n  bytes_transferred \n FROM snowflake . account_usage . replication_group_usage_history \n WHERE start_time >= DATE_TRUNC ( 'month' , CURRENT_DATE ());\n```\n\nCopy\n\nQuery: Database replication cost history (by day, by object)\n    This query provides a full list of replicated databases and the volume of credits consumed via the replication service over the last 30\ndays, broken out by day. Any irregularities in the credit consumption or consistently high consumption are flags for additional\ninvestigation.\n\n```\nSELECT TO_DATE ( start_time ) AS date , \n  database_name , \n  SUM ( credits_used ) AS credits_used \n FROM snowflake . account_usage . database_replication_usage_history \n WHERE start_time >= DATEADD ( month ,- 1 , CURRENT_TIMESTAMP ()) \n GROUP BY 1 , 2 \n ORDER BY 3 DESC ;\n```\n\nCopy\n\nQuery: Database replication History & m-day average\n    This query shows the average daily credits consumed by Replication grouped by week over the last year. This helps identify any\nanomalies in the daily average so you can investigate any spikes or changes in consumption.\n\n```\nWITH credits_by_day AS ( \n  SELECT TO_DATE ( start_time ) AS date , \n    SUM ( credits_used ) AS credits_used \n  FROM snowflake . account_usage . database_replication_usage_history \n  WHERE start_time >= DATEADD ( year ,- 1 , CURRENT_TIMESTAMP ()) \n  GROUP BY 1 \n  ORDER BY 2 DESC \n ) \n\n SELECT DATE_TRUNC ( 'week' , date ), \n  AVG ( credits_used ) AS avg_daily_credits \n FROM credits_by_day \n GROUP BY 1 \n ORDER BY 1 ;\n```\n\nCopy\n\n#### Compute for partner tools \u00b6\n\nQuery: Credit consumption by partner tools\n    This query identifies which of Snowflake\u2019s partner tools/solutions (e.g. BI, ETL, etc.) are consuming the most credits. This can help\nidentify partner solutions that are consuming more credits than anticipated, which can be a starting point for additional investigation.\n\n```\n-- This Is Approximate Credit Consumption By Client Application \n WITH \n  client_hour_execution_cte AS ( \n    SELECT \n      CASE \n        WHEN client_application_id LIKE 'Go %' THEN 'Go' \n        WHEN client_application_id LIKE 'Snowflake UI %' THEN 'Snowflake UI' \n        WHEN client_application_id LIKE 'Snowflake CLI %' THEN 'Snowflake CLI' \n        WHEN client_application_id LIKE 'SnowSQL %' THEN 'SnowSQL' \n        WHEN client_application_id LIKE 'JDBC %' THEN 'JDBC' \n        WHEN client_application_id LIKE 'PythonConnector %' THEN 'Python' \n        WHEN client_application_id LIKE 'ODBC %' THEN 'ODBC' \n        ELSE 'NOT YET MAPPED: ' || CLIENT_APPLICATION_ID \n      END AS client_application_name , \n      warehouse_name , \n      DATE_TRUNC ( 'hour' , start_time ) AS start_time_hour , \n      SUM ( execution_time )  AS client_hour_execution_time \n    FROM snowflake . account_usage . query_history qh \n      JOIN snowflake . account_usage . sessions se \n        ON se . session_id = qh . session_id \n    WHERE warehouse_name IS NOT NULL \n      AND execution_time > 0 \n      AND start_time > DATEADD ( month ,- 1 , CURRENT_TIMESTAMP ()) \n    GROUP BY 1 , 2 , 3 \n  ), \n  hour_execution_cte AS ( \n    SELECT start_time_hour , \n      warehouse_name , \n      SUM ( client_hour_execution_time ) AS hour_execution_time \n    FROM client_hour_execution_cte \n    GROUP BY 1 , 2 \n  ), \n  approximate_credits AS ( \n    SELECT A . client_application_name , \n      C . warehouse_name , \n      ( A . client_hour_execution_time / B . hour_execution_time )* C . credits_used AS approximate_credits_used \n    FROM client_hour_execution_cte A \n      JOIN hour_execution_cte B \n        ON A . start_time_hour = B . start_time_hour and B . warehouse_name = A . warehouse_name \n      JOIN snowflake . account_usage . warehouse_metering_history C \n        ON C . warehouse_name = A . warehouse_name AND C . start_time = A . start_time_hour \n  ) \n\n SELECT client_application_name , \n  warehouse_name , \n  SUM ( approximate_credits_used ) AS approximate_credits_used \n FROM approximate_credits \n GROUP BY 1 , 2 \n ORDER BY 3 DESC ;\n```\n\nCopy\n\n#### Compute for hybrid tables \u00b6\n\nQuery: Credit consumption for hybrid tables over a specific period of time\n    This query shows the total credit consumption for hybrid tables in your account over a\nspecific period of time. This helps track hybrid table credit usage\nagainst expectations.\n\n```\n-- Credits used (all time = past year) \n\n SELECT SUM ( credits_used ) AS total_credits \n  FROM SNOWFLAKE . ACCOUNT_USAGE . HYBRID_TABLE_USAGE_HISTORY ; \n\n -- Credits used (past N days/weeks/months) \n\n SELECT SUM ( credits_used ) AS total_credits \n  FROM SNOWFLAKE . ACCOUNT_USAGE . HYBRID_TABLE_USAGE_HISTORY \n  WHERE start_time >= DATEADD ( day , - 5 , CURRENT_TIMESTAMP ());\n```\n\nCopy\n\n#### Compute for Cortex Agents \u00b6\n\nQuery: Credit consumption by Cortex Agents.\n    This query shows the credit consumption for Cortex Agents.\n\n```\nSELECT * \n  FROM SNOWFLAKE . ACCOUNT_USAGE . CORTEX_AGENT_USAGE_HISTORY ;\n```\n\nCopy\n\n#### Compute for Cortex Analyst \u00b6\n\nQuery: Credit consumption by Cortex Analyst.\n    This query shows the credit consumption for Cortex Analyst.\n\n```\nSELECT * \n  FROM SNOWFLAKE . ACCOUNT_USAGE . CORTEX_ANALYST_USAGE_HISTORY ;\n```\n\nCopy\n\n#### Compute for Cortex Fine-tuning \u00b6\n\nQuery: Credit consumption by Cortex Fine-tuning.\n    This query shows the training credit consumption for each Cortex Fine-tuning,\naggregated in one hour increments.\n\n```\nSELECT * \n  FROM SNOWFLAKE . ACCOUNT_USAGE . CORTEX_FINE_TUNING_USAGE_HISTORY ;\n```\n\nCopy\n\n#### Compute for Cortex functions \u00b6\n\nQuery: Credit consumption by Cortex functions.\n    This query shows the credit consumption for each Cortex function call, aggregated in one hour increments based on\nfunction and model.\n\n```\nSELECT * \n  FROM SNOWFLAKE . ACCOUNT_USAGE . CORTEX_FUNCTIONS_USAGE_HISTORY ;\n```\n\nCopy\nQuery: Credit consumption by Cortex function called with the `mistral-large` model.\n    This query shows the credit consumption for each Cortex function called with the `mistral-large` model, aggregated in one\nhour increments based on function and model.\n\n```\nSELECT * \n  FROM SNOWFLAKE . ACCOUNT_USAGE . CORTEX_FUNCTIONS_USAGE_HISTORY \n  WHERE model_name = 'mistral-large' ;\n```\n\nCopy\n\nQuery: Credit consumption by Cortex functions query.\n    This query shows the credit consumption for each Cortex functions query, aggregated in one hour increments based on\nfunction and model.\n\n```\nSELECT * \n  FROM SNOWFLAKE . ACCOUNT_USAGE . CORTEX_FUNCTIONS_QUERY_USAGE_HISTORY \n  WHERE query_id = 'query-id' ;\n```\n\nCopy\n\n#### Compute for Cortex REST API \u00b6\n\nQuery: Credit consumption by Cortex REST API.\n    This query shows the credit consumption for Cortex REST API calls, including the number of tokens processed\nand the model used for each request.\n\n```\nSELECT * \n  FROM SNOWFLAKE . ACCOUNT_USAGE . CORTEX_REST_API_USAGE_HISTORY ;\n```\n\nCopy\n\n#### Compute for Cortex Search \u00b6\n\nQuery: Daily credit consumption by Cortex Search.\n    This query shows the credit consumption for each Cortex Search Service,\naggregated daily, including both serving and embed text token consumption.\n\n```\nSELECT * \n  FROM SNOWFLAKE . ACCOUNT_USAGE . CORTEX_SEARCH_DAILY_USAGE_HISTORY ;\n```\n\nCopy\n\nQuery: Credit consumption by Cortex Search serving.\n    This query shows the serving credit consumption for each Cortex Search Service,\naggregated in one hour increments.\n\n```\nSELECT * \n  FROM SNOWFLAKE . ACCOUNT_USAGE . CORTEX_SEARCH_SERVING_USAGE_HISTORY ;\n```\n\nCopy\n\n#### Compute for Document AI \u00b6\n\nQuery: Credit consumption by Document AI.\n    This query shows the credit consumption for Document AI.\n\n```\nSELECT * \n  FROM SNOWFLAKE . ACCOUNT_USAGE . DOCUMENT_AI_USAGE_HISTORY ;\n```\n\nCopy\n\nQuery: Credit consumption per Document AI query.\n    This query retrieves records from the CORTEX\\_DOCUMENT\\_PROCESSING\\_USAGE\\_HISTORY view where the CREDITS\\_USED is greater than 0.072.\n\n```\nSELECT * \n  FROM SNOWFLAKE . ACCOUNT_USAGE . CORTEX_DOCUMENT_PROCESSING_USAGE_HISTORY \n  WHERE CREDITS_USED > 0 . 072\n```\n\nCopy\n\n#### Compute for Snowflake Intelligence \u00b6\n\nQuery: Credit consumption by Snowflake Intelligence.\n    This query shows the credit consumption for Snowflake Intelligence.\n\n```\nSELECT * \n  FROM SNOWFLAKE . ACCOUNT_USAGE . SNOWFLAKE_INTELLIGENCE_USAGE_HISTORY ;\n```\n\nCopy\n\n#### Compute for Snowflake Notebooks \u00b6\n\nQuery: Hourly credit consumption by notebook\n    This query retrieves runtime history for a specific notebook, including credit usage and execution timestamps. Use this data to understand how\noften and how long a notebook runs, and to identify patterns or spikes in credit consumption by hour.\n\n```\nSELECT * FROM snowflake . account_usage . notebooks_container_runtime_history \n WHERE notebook_name = '<example_nb_name>' ;\n```\n\nCopy\n\nQuery: Cost to run a specific notebook\n    This query shows the total credits consumed by a specific notebook. Use this to estimate a notebook\u2019s cost and identify high-cost notebooks.\n\n```\nSELECT \n  notebook_name , \n  SUM ( credits ) AS total_credits \n FROM snowflake . account_usage . notebooks_container_runtime_history \n WHERE notebook_name = '<example_nb_name>' \n GROUP BY notebook_name ;\n```\n\nCopy\n\nQuery: Total compute pool cost per notebook\n    This query shows the total credits consumed by each notebook running on a specific compute pool. Use this to break down compute usage by\nnotebook, which can help identify which notebooks contribute most to the compute pool\u2019s overall cost.\n\n```\nSELECT \n  notebook_name , \n  SUM ( credits ) AS total_credits \n FROM snowflake . account_usage . notebooks_container_runtime_history \n WHERE compute_pool_name = '<example_cp_name>' \n GROUP BY notebook_name ;\n```\n\nCopy\n\nQuery: Identify users who ran a specific notebook\n    This query returns a list of users who have executed a specific notebook. Use this to understand usage patterns, or identify collaborators\nand consumers of shared notebooks.\n\n```\nSELECT \n  DISTINCT user_name \n FROM snowflake . account_usage . notebooks_container_runtime_history \n WHERE notebook_name = '<example_nb_name>' ;\n```\n\nCopy\n\nWas this page helpful?\n\nYes No\n\n[Visit Snowflake](https://www.snowflake.com)\n\n[Join the conversation](https://community.snowflake.com/s/)\n\n[Develop with Snowflake](https://developers.snowflake.com)\n\nShare your feedback\n\n[Read the latest on our blog](https://www.snowflake.com/blog/)\n\n[Get your own certification](https://learn.snowflake.com)\n\nOn this page\n\n1. Viewing credit usage\n2. Querying data for compute cost\n\nRelated content\n\n1. Understanding compute cost\n2. Exploring overall cost\n3. Attributing cost"
      ],
      "full_content": null
    }
  ],
  "errors": [],
  "warnings": [
    {
      "type": "warning",
      "message": "Neither objective nor search_queries were provided, provide at least one to increase the relevance of excerpts.",
      "detail": null
    }
  ],
  "usage": [
    {
      "name": "sku_extract_excerpts",
      "count": 1
    }
  ]
}
