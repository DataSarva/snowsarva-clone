{
  "search_id": "search_fb9bb7bdf93745bdbd01f47aab1e596e",
  "results": [
    {
      "url": "https://docs.snowflake.com/en/sql-reference/account-usage",
      "title": "Account Usage | Snowflake Documentation",
      "excerpts": [
        "Reference General reference SNOWFLAKE database Account Usage\nSection Title: Account Usage \u00b6\nContent:\nIn the SNOWFLAKE database, the ACCOUNT_USAGE and READER_ACCOUNT_USAGE schemas enable querying object metadata, as well as historical\nusage data, for your account and all reader accounts (if any) associated with the account.\nSection Title: Account Usage \u00b6 > Overview of Account Usage schemas \u00b6\nContent:\nACCOUNT_USAGE :\nViews that display object metadata and usage metrics for your account.\nIn general, these views mirror the corresponding views and table functions in the Snowflake Snowflake Information Schema , but\nwith the following differences:\nRecords for dropped objects included in each view.\nLonger retention time for historical usage data.\nData latency.\nFor more details, see Differences Between Account Usage and Information Schema (in this topic). For more details about each\nview, see ACCOUNT_USAGE Views (in this topic).\nREADER_ACCOUNT_USAGE :\nViews that display object metadata and usage metrics for all the reader accounts that have been created for\nyour account (as a Secure Data Sharing provider).\nThese views are a small subset of the ACCOUNT_USAGE views that apply to reader accounts. Also, each view in this schema contains an\nadditional `READER_ACCOUNT_NAME` column for filtering results by reader account.\n ... \nSection Title: Account Usage \u00b6 > ACCOUNT_USAGE views \u00b6\nContent:\nThe ACCOUNT_USAGE schema contains the following views:\n ... \nSection Title: Account Usage \u00b6 > ACCOUNT_USAGE views \u00b6\nContent:\n| View | Type | Latency [1] | Edition [3] | Notes |\n| ACCESS_HISTORY | Historical | 3 hours | Enterprise Edition (or higher) | Data retained for 1 year. |\n| AGGREGATE_ACCESS_HISTORY | Historical | 3 hours | Enterprise Edition (or higher) | Data retained for 1 year. |\n| AGGREGATE_QUERY_HISTORY | Historical | 3 hours |  |  |\n| AGGREGATION_POLICIES | Object | 2 hours |  |  |\n| CORTEX_ANALYST_USAGE_HISTORY | Historical | One hour |  | Data retained for 1 year. |\n| CORTEX_DOCUMENT_PROCESSING_USAGE_HISTORY | Historical | 1 hour |  | Data retained for 1 year. |\n| CORTEX_FINE_TUNING_USAGE_HISTORY | Historical | 1 hour |  | Data retained for 1 year. |\n| CORTEX_FUNCTIONS_QUERY_USAGE_HISTORY | Historical |  |  | Data retained for 1 year. |\n| CORTEX_FUNCTIONS_USAGE_HISTORY | Historical |  |  | Data retained for 1 year. |\n| CORTEX_PROVISIONED_THROUGHPUT_USAGE_HISTORY | Historical |  |  | Data retained for 1 year. |\n ... \nSection Title: Account Usage \u00b6 > ACCOUNT_USAGE views \u00b6\nContent:\n| View | Type | Latency [1] | Edition [3] | Notes |\n| ACCESS_HISTORY | Historical | 3 hours | Enterprise Edition (or higher) | Data retained for 1 year. |\n| AGGREGATE_ACCESS_HISTORY | Historical | 3 hours | Enterprise Edition (or higher) | Data retained for 1 year. |\n| AGGREGATE_QUERY_HISTORY | Historical | 3 hours |  |  |\n| AGGREGATION_POLICIES | Object | 2 hours |  |  |\n| GRANTS_TO_USERS | Object | 2 hours |  |  |\n| HYBRID_TABLES | Object | 3 hours |  |  |\n| HYBRID_TABLE_USAGE_HISTORY | Historical | 3 hours |  | Data retained for 1 year. |\n| ICEBERG_STORAGE_OPTIMIZATION_HISTORY | Historical | 2 hours |  | Data retained for 1 year. |\n| INDEX_COLUMNS | Object | 3 hours |  |  |\n| INDEXES | Object | 3 hours |  |  |\n| INGRESS_NETWORK_ACCESS_HISTORY | Historical | 4 hours |  | Data retained for 1 year. |\n| INTERNAL_DATA_TRANSFER_HISTORY | Historical | 3 hours |  |  |\n ... \nSection Title: Account Usage \u00b6 > ACCOUNT_USAGE views \u00b6\nContent:\n| View | Type | Latency [1] | Edition [3] | Notes |\n| ACCESS_HISTORY | Historical | 3 hours | Enterprise Edition (or higher) | Data retained for 1 year. |\n| AGGREGATE_ACCESS_HISTORY | Historical | 3 hours | Enterprise Edition (or higher) | Data retained for 1 year. |\n| AGGREGATE_QUERY_HISTORY | Historical | 3 hours |  |  |\n| AGGREGATION_POLICIES | Object | 2 hours |  |  |\n| METERING_DAILY_HISTORY | Historical | 3 hours |  | Data retained for 1 year. |\n| METERING_HISTORY | Historical | 3 hours |  | Data retained for 1 year. |\n| NETWORK_POLICIES | Object | 2 hours |  |  |\n| NETWORK_RULE_REFERENCES | Object | 2 hours |  |  |\n| NETWORK_RULES | Object | 2 hours |  |  |\n| NOTEBOOKS_CONTAINER_RUNTIME_HISTORY | Historical | 3 hours |  |  |\n| OBJECT_ACCESS_REQUEST_HISTORY | Historical | 3 hours |  |  |\n| OBJECT_DEPENDENCIES | Historical | 3 hours |  |  |\n| ONLINE_FEATURE_TABLE_REFRESH_HISTORY | Historical | 3 hours |  |  |\n ... \nSection Title: Account Usage \u00b6 > ACCOUNT_USAGE views \u00b6\nContent:\n| View | Type | Latency [1] | Edition [3] | Notes |\n| ACCESS_HISTORY | Historical | 3 hours | Enterprise Edition (or higher) | Data retained for 1 year. |\n| AGGREGATE_ACCESS_HISTORY | Historical | 3 hours | Enterprise Edition (or higher) | Data retained for 1 year. |\n| AGGREGATE_QUERY_HISTORY | Historical | 3 hours |  |  |\n| AGGREGATION_POLICIES | Object | 2 hours |  |  |\n| SEMANTIC_VIEWS | Object | 2 hours |  |  |\n| SEQUENCES | Object | 2 hours |  |  |\n| SERVERLESS_ALERT_HISTORY | Historical | 3 hours |  | Data retained for 1 year. |\n| SERVERLESS_TASK_HISTORY | Historical | 3 hours |  | Data retained for 1 year. |\n| SERVICES | Object | 3 hours |  |  |\n| SESSION_POLICIES | Object | 2 hours |  |  |\n| SESSIONS | Historical | 3 hours |  | Data retained for 1 year. |\n| SHARES | Object | 3 hours |  |  |\nSection Title: Account Usage \u00b6 > ACCOUNT_USAGE views \u00b6\nContent:\n| View | Type | Latency [1] | Edition [3] | Notes |\n| ACCESS_HISTORY | Historical | 3 hours | Enterprise Edition (or higher) | Data retained for 1 year. |\n| AGGREGATE_ACCESS_HISTORY | Historical | 3 hours | Enterprise Edition (or higher) | Data retained for 1 year. |\n| AGGREGATE_QUERY_HISTORY | Historical | 3 hours |  |  |\n| AGGREGATION_POLICIES | Object | 2 hours |  |  |\n| SNAPSHOT_OPERATION_HISTORY | Historical | 6 hours |  | Data retained for 1 year. This view is deprecated. Use the BACKUP_OPERATION_HISTORY view instead. |\n| SNAPSHOT_POLICIES | Object | 6 hours |  | This view is deprecated. Use the BACKUP_POLICIES view instead. |\n| SNAPSHOT_SETS | Object | 6 hours |  | This view is deprecated. Use the BACKUP_SETS view instead. |\n| SNAPSHOT_STORAGE_USAGE | Historical | 6 hours |  | Data retained for 1 year. This view is deprecated. Use the BACKUP_STORAGE_USAGE view instead. |\nSection Title: Account Usage \u00b6 > ACCOUNT_USAGE views \u00b6\nContent:\n| View | Type | Latency [1] | Edition [3] | Notes |\n| ACCESS_HISTORY | Historical | 3 hours | Enterprise Edition (or higher) | Data retained for 1 year. |\n| AGGREGATE_ACCESS_HISTORY | Historical | 3 hours | Enterprise Edition (or higher) | Data retained for 1 year. |\n| AGGREGATE_QUERY_HISTORY | Historical | 3 hours |  |  |\n| AGGREGATION_POLICIES | Object | 2 hours |  |  |\n| SNAPSHOTS | Object | 6 hours |  | This view is deprecated. Use the BACKUPS view instead. |\n| SNOWFLAKE_INTELLIGENCE_USAGE_HISTORY | Historical |  |  | Data retained for 1 year. |\n| SNOWPARK_CONTAINER_SERVICES_HISTORY | Historical | 3 hour |  | Data retained for 1 year. |\n| SNOWPIPE_STREAMING_CHANNEL_HISTORY | Historical |  |  |  |\n| SNOWPIPE_STREAMING_CLIENT_HISTORY | Historical | 2 hours |  | Data retained for 1 year. |\n| SNOWPIPE_STREAMING_FILE_MIGRATION_HISTORY | Historical | 12 hours |  | Data retained for 1 year. |\n| STAGES | Object | 2 hours |  |  |\n ... \nSection Title: Account Usage \u00b6 > ACCOUNT_USAGE views \u00b6\nContent:\n| View | Type | Latency [1] | Edition [3] | Notes |\n| ACCESS_HISTORY | Historical | 3 hours | Enterprise Edition (or higher) | Data retained for 1 year. |\n| AGGREGATE_ACCESS_HISTORY | Historical | 3 hours | Enterprise Edition (or higher) | Data retained for 1 year. |\n| AGGREGATE_QUERY_HISTORY | Historical | 3 hours |  |  |\n| AGGREGATION_POLICIES | Object | 2 hours |  |  |\n| TABLE_PRUNING_HISTORY | Historical | 6 hours |  | Data retained for 1 year. |\n| TABLE_QUERY_PRUNING_HISTORY | Historical | 4 hours |  | Data retained for 1 year. |\n| TABLE_STORAGE_METRICS | Object | 90 minutes |  |  |\n| TAG_REFERENCES | Object | 2 hours |  |  |\n| TAGS | Object | 2 hours |  |  |\n| TASK_HISTORY | Historical | 45 minutes |  |  |\n| TASK_VERSIONS | Object | 3 hours |  |  |\n| TRUST_CENTER_FINDINGS | Historical | 1 hour |  |  |\n| USERS | Object | 2 hours |  |  |\n| VIEWS | Object | 90 minutes |  |  |\nSection Title: Account Usage \u00b6 > ACCOUNT_USAGE views \u00b6\nContent:\n| View | Type | Latency [1] | Edition [3] | Notes |\n| ACCESS_HISTORY | Historical | 3 hours | Enterprise Edition (or higher) | Data retained for 1 year. |\n| AGGREGATE_ACCESS_HISTORY | Historical | 3 hours | Enterprise Edition (or higher) | Data retained for 1 year. |\n| AGGREGATE_QUERY_HISTORY | Historical | 3 hours |  |  |\n| AGGREGATION_POLICIES | Object | 2 hours |  |  |\n| WAREHOUSE_EVENTS_HISTORY | Historical | 3 hours |  | Data retained for 1 year. |\n| WAREHOUSE_LOAD_HISTORY | Historical | 3 hours |  | Data retained for 1 year. |\n| WAREHOUSE_METERING_HISTORY | Historical | 3 hours |  | Data retained for 1 year. |\nSection Title: Account Usage \u00b6 > ACCOUNT_USAGE views \u00b6\nContent:\n[1] All latency times are approximate; in some instances, the actual latency may be lower.\n[2] The latency of the views for a given table may be up to 2 days if both of the following conditions are true: 1. Fewer than 32 DML statements have been added to the given table since it was last updated in LOAD_HISTORY or COPY_HISTORY. 2. Fewer than 100 rows have been added to the given table since it was last updated in LOAD_HISTORY or COPY_HISTORY.\n[3] Unless otherwise noted, the Account Usage view is available to all accounts.\nSection Title: Account Usage \u00b6 > ACCOUNT_USAGE views \u00b6 > Account Usage table functions \u00b6\nContent:\nCurrently, Snowflake supports one ACCOUNT_USAGE table function:\nSection Title: Account Usage \u00b6 > ACCOUNT_USAGE views \u00b6 > Account Usage table functions \u00b6\nContent:\n| Table Function | Data Retention | Notes |\n| TAG_REFERENCES_WITH_LINEAGE | N/A | Results are only returned for the role that has access to the specified object. |\nSection Title: Account Usage \u00b6 > ACCOUNT_USAGE views \u00b6 > Account Usage table functions \u00b6\nContent:\nNote\nSimilar to the Account Usage views, please account for latency when calling this table function. The expected latency for this table\nfunction is similar to the latency for the TAG_REFERENCES view.\n ... \nSection Title: Account Usage \u00b6 > ... > ACCOUNT_ USAGE schema SNOWFLAKE database roles \u00b6\nContent:\nIn addition, you can grant finer control to accounts using SNOWFLAKE Database roles.\nFor more information on database roles, see database roles .\nACCOUNT_USAGE schemas have four defined SNOWFLAKE database roles, each granted the SELECT privilege on specific views.\n ... \nSection Title: Account Usage \u00b6 > ... > Database role required to access ACCOUNT_ USAGE views \u00b6\nContent:\n| View | Database Role |\n| ACCESS_HISTORY view | GOVERNANCE_VIEWER |\n| APPLICATION_CONFIGURATIONS view | SECURITY_VIEWER |\n| AGGREGATE_ACCESS_HISTORY view | GOVERNANCE_VIEWER |\n| AGGREGATE_QUERY_HISTORY view | GOVERNANCE_VIEWER |\n| NETWORK_RULES view | SECURITY_VIEWER |\n| NOTEBOOKS_CONTAINER_RUNTIME_HISTORY view | USAGE_VIEWER |\n| OBJECT_ACCESS_REQUEST_HISTORY view | OBJECT_VIEWER |\n| OBJECT_DEPENDENCIES view | OBJECT_VIEWER |\n| ACCOUNT_USAGE.ONLINE_FEATURE_TABLE_REFRESH_HISTORY | USAGE_VIEWER |\n| OPENFLOW_USAGE_HISTORY view | USAGE_VIEWER |\n| OUTBOUND_PRIVATELINK_ENDPOINTS view | SECURITY_VIEWER |\n| PASSWORD_POLICIES view | SECURITY_VIEWER |\n| PIPE_USAGE_HISTORY view | USAGE_VIEWER |\n| PIPES view | OBJECT_VIEWER |\n| POLICY_REFERENCES view | GOVERNANCE_VIEWER, SECURITY_VIEWER |\n| POSTGRES_STORAGE_USAGE_HISTORY view | USAGE_VIEWER |\n| PRIVACY_BUDGETS view | GOVERNANCE_VIEWER |\n ... \nSection Title: Account Usage \u00b6 > Querying the Account Usage views \u00b6 > Reconciling cost views \u00b6\nContent:\nThere are several Account Usage views that contain data related to the cost of compute resources, storage, and data transfers. If you are trying to reconcile these views against a corresponding view in the ORGANIZATION_USAGE schema , you must first set the timezone of the session to UTC.\nFor example, if you are trying to reconcile ACCOUNT_USAGE.WAREHOUSE_METERING_HISTORY to the account\u2019s data in ORGANIZATION_USAGE.WAREHOUSE_METERING_HISTORY, you must run the following command before querying the Account Usage view:\n```\nALTER SESSION SET TIMEZONE = UTC ;\n```\nCopy\nSection Title: Account Usage \u00b6 > Querying the Account Usage views \u00b6 > Examples \u00b6\nContent:\nThe following examples show some typical/useful queries using the views in the ACCOUNT_USAGE schema.\nNote\nThese examples assume the SNOWFLAKE database and the ACCOUNT_USAGE schema are in use for the current session. The examples also\nassume the ACCOUNTADMIN role (or a role granted IMPORTED PRIVILEGES on the database) is in use. If they are not in use, execute\nthe following commands before running the queries in the examples:Copy\n ... \nSection Title: Account Usage \u00b6 > ... > Examples \u00b6 > Examples: Warehouse performance \u00b6\nContent:\nThis query calculates virtual warehouse performance metrics such as throughput and latency for 15-minute time intervals over the course of\none day.\nIn the code sample below, you can replace `CURRENT_WAREHOUSE()` with the name of a warehouse to calculate metrics for that warehouse. In\naddition, change the `time_from` and `time_to` dates in the WITH clause to specify the time period.\nCopyNoteAnalyze different statement types separately (e.g., SELECT statements independent of INSERT or DELETE or other statements).\nSection Title: Account Usage \u00b6 > ... > Examples \u00b6 > Examples: Warehouse performance \u00b6\nContent:\nThe NUMJOBS value represents the throughput for that time interval.\nThe P50_TOTAL_DURATION (median) and P95_TOTAL_DURATION (peak) values represent latency.\nThe SUM_TOTAL_DURATION is the sum of the SUM_<job_stage>_TIME values for the different job stages (COMPILATION_AND_SCHEDULING, QUEUED,\nBLOCKED, EXECUTION).\nAnalyze the <job_stage>_RATIO values when the load (NUMJOBS) increases. Look for ratio changes or deviations from the average.\nIf the QUEUED_RATIO is high, there might not be sufficient capacity in the warehouse. Add more clusters or increase the warehouse size.\nSection Title: Account Usage \u00b6 > ... > Examples \u00b6 > Examples: Warehouse credit usage \u00b6\nContent:\nCredits used by each warehouse in your account (month-to-date):\nCopy\nCredits used over time by each warehouse in your account (month-to-date):\nCopy\n ... \nSection Title: Account Usage \u00b6 > ... > Examples \u00b6 > Examples: User query totals and execution times \u00b6\nContent:\nTotal jobs executed in your account (month-to-date):\nCopy\nTotal jobs executed by each warehouse in your account (month-to-date):\nCopy\nAverage query execution time by user (month-to-date):\nCopy\nAverage query execution time by query type and warehouse size (month-to-date):\nCopy"
      ]
    },
    {
      "url": "https://docs.snowflake.com/en/sql-reference/functions/warehouse_metering_history",
      "title": "WAREHOUSE_METERING_HISTORY | Snowflake Documentation",
      "excerpts": [
        "Reference Function and stored procedure reference Table WAREHOUSE_METERING_HISTORY\nCategories:\nInformation Schema , Table functions\nSection Title: WAREHOUSE_METERING_HISTORY \u00b6\nContent:\nThis table function can be used in queries to return the hourly credit usage for a single warehouse (or all the warehouses in your account) within a specified date range.\nNote\nThis function returns credit usage within the last 6 months. However, if you are querying multiple warehouses over a lengthy time period,\nit might not return a complete data set. To obtain a complete data set, use the ACCOUNT_USAGE view instead.\nSee also:\nWAREHOUSE_LOAD_HISTORY\nSection Title: WAREHOUSE_METERING_HISTORY \u00b6 > Syntax \u00b6\nContent:\n```\nWAREHOUSE_METERING_HISTORY ( \n      DATE_RANGE_START => <constant_expr> \n      [ , DATE_RANGE_END => <constant_expr> ] \n      [ , WAREHOUSE_NAME => '<string>' ] )\n```\nCopy\nSection Title: WAREHOUSE_METERING_HISTORY \u00b6 > Arguments \u00b6\nContent:\n**Required:**\n`DATE_RANGE_START => _constant_expr_`\nThe starting date, within the last 6 months, for which warehouse usage is returned.\n**Optional:**\n`DATE_RANGE_END => _constant_expr_`\nThe ending date, within the last 6 months, for which warehouse usage is returned.\nDefault: CURRENT_DATE is used. `WAREHOUSE_NAME => ' _string_ '`\nThe name of the warehouse to retrieve credit usage for. Note that the warehouse name must be enclosed in single quotes. Also, if the warehouse name any spaces, mixed-case characters,\nor special characters, the name must be double-quoted within the single quotes (e.g. `'\"My Warehouse\"'` vs `'mywarehouse'` ).\nDefault: All warehouses that ran during the specified date range.\nSection Title: WAREHOUSE_METERING_HISTORY \u00b6 > Usage notes \u00b6\nContent:\nReturns results only for the ACCOUNTADMIN role or any role that has been explicitly granted the MONITOR USAGE global privilege.\nWhen calling an Information Schema table function, the session must have an INFORMATION_SCHEMA schema in use or the function name must be fully-qualified. For more details, see Snowflake Information Schema .\nThe order and structure of the arguments depends on whether the argument keywords (e.g. `DATE_RANGE_START` ) are included:\nThe keywords are not required if the arguments are specified in order.\nIf the argument keywords are included, the arguments can be specified in any order.\nSection Title: WAREHOUSE_METERING_HISTORY \u00b6 > Output \u00b6\nContent:\nThe function returns the following columns, ordered by WAREHOUSE_NAME and START_TIME:\nSection Title: WAREHOUSE_METERING_HISTORY \u00b6 > Output \u00b6\nContent:\n| Column Name | Data Type | Description |\n| START_TIME | TIMESTAMP_LTZ | The beginning of the hour in which this warehouse usage took place. |\n| END_TIME | TIMESTAMP_LTZ | The end of the hour in which this warehouse usage took place. |\n| WAREHOUSE_NAME | VARCHAR | Name of the warehouse. |\n| CREDITS_USED | NUMBER | Number of credits billed for this warehouse in this hour. |\n| CREDITS_USED_COMPUTE | NUMBER | Number of credits used for the warehouse in the hour. |\n| CREDITS_USED_CLOUD_SERVICES | NUMBER | Number of credits used for cloud services in the hour. |\nSection Title: WAREHOUSE_METERING_HISTORY \u00b6 > Examples \u00b6\nContent:\nRetrieve hourly warehouse usage over the past 10 days for all warehouses that ran during this time period:\nCopy\nRetrieve hourly warehouse usage for the `testingwh` warehouse on a specified date:\nCopy\nWas this page helpful?\nYes No\n[Visit Snowflake](https://www.snowflake.com)\n[Join the conversation](https://community.snowflake.com/s/)\n[Develop with Snowflake](https://developers.snowflake.com)\nShare your feedback\n[Read the latest on our blog](https://www.snowflake.com/blog/)\n[Get your own certification](https://learn.snowflake.com)\nOn this page\nSyntax\nArguments\nUsage notes\nOutput\nExamples"
      ]
    },
    {
      "url": "https://docs.snowflake.com/en/sql-reference/account-usage/warehouse_metering_history",
      "title": "WAREHOUSE_METERING_HISTORY view | Snowflake Documentation",
      "excerpts": [
        "Reference General reference SNOWFLAKE database Account Usage WAREHOUSE_METERING_HISTORY\nSchemas:\nACCOUNT_USAGE , READER_ACCOUNT_USAGE\nSection Title: WAREHOUSE_ METERING_ HISTORY view \u00b6\nContent:\nThis Account Usage view can be used to return the hourly credit usage for a single warehouse (or all the warehouses in your account) within the last 365 days (1 year).\nSection Title: WAREHOUSE_ METERING_ HISTORY view \u00b6 > Columns \u00b6\nContent:\n| Column Name | Data Type | Description |\n| READER_ACCOUNT_NAME | VARCHAR | Name of the reader account where the warehouse usage took place. Column only included in view in READER_ACCOUNT_USAGE schema. |\n| START_TIME | TIMESTAMP_LTZ | The date and beginning of the hour (in the local time zone) in which the warehouse usage took place. |\n| END_TIME | TIMESTAMP_LTZ | The date and end of the hour (in the local time zone) in which the warehouse usage took place. |\n| WAREHOUSE_ID | NUMBER | Internal/system-generated identifier for the warehouse. |\n| WAREHOUSE_NAME | VARCHAR | Name of the warehouse. |\nSection Title: WAREHOUSE_ METERING_ HISTORY view \u00b6 > Columns \u00b6\nContent:\n| Column Name | Data Type | Description |\n| READER_ACCOUNT_NAME | VARCHAR | Name of the reader account where the warehouse usage took place. Column only included in view in READER_ACCOUNT_USAGE schema. |\n| START_TIME | TIMESTAMP_LTZ | The date and beginning of the hour (in the local time zone) in which the warehouse usage took place. |\n| END_TIME | TIMESTAMP_LTZ | The date and end of the hour (in the local time zone) in which the warehouse usage took place. |\n| WAREHOUSE_ID | NUMBER | Internal/system-generated identifier for the warehouse. |\n| CREDITS_USED | NUMBER | Total number of credits used for the warehouse in the hour. This is a sum of CREDITS_USED_COMPUTE and CREDITS_USED_CLOUD_SERVICES. This value does not take into account the adjustment for cloud services , and may therefore be greater than the credits that are billed. To determine how many credits were actually billed, run queries against the METERING_DAILY_HISTORY view . |\nSection Title: WAREHOUSE_ METERING_ HISTORY view \u00b6 > Columns \u00b6\nContent:\n| Column Name | Data Type | Description |\n| READER_ACCOUNT_NAME | VARCHAR | Name of the reader account where the warehouse usage took place. Column only included in view in READER_ACCOUNT_USAGE schema. |\n| START_TIME | TIMESTAMP_LTZ | The date and beginning of the hour (in the local time zone) in which the warehouse usage took place. |\n| END_TIME | TIMESTAMP_LTZ | The date and end of the hour (in the local time zone) in which the warehouse usage took place. |\n| WAREHOUSE_ID | NUMBER | Internal/system-generated identifier for the warehouse. |\n| CREDITS_USED_COMPUTE | NUMBER | Number of credits used for the warehouse in the hour. |\n| CREDITS_USED_CLOUD_SERVICES | NUMBER | Number of credits used for cloud services in the hour. |\n| CREDITS_ATTRIBUTED_COMPUTE_QUERIES | NUMBER | Number of credits attributed to queries in the hour. . . Includes only the credit usage for query execution and doesn\u2019t include warehouse idle time usage. |\nSection Title: WAREHOUSE_ METERING_ HISTORY view \u00b6 > Usage notes \u00b6\nContent:\nIn the ACCOUNT_USAGE schema, latency for the view is up to 180 minutes (3 hours), except for the CREDITS_USED_CLOUD_SERVICES column. Latency for\nCREDITS_USED_CLOUD_SERVICES is up to 6 hours.\nIn the READER_ACCOUNT_USAGE schema, latency for the view is up to 24 hours.\nWarehouse idle time is not included in the CREDITS_ATTRIBUTED_COMPUTE_QUERIES column.See Examples for a query that calculates the cost of idle time.\nIf you want to reconcile the data in this view with a corresponding view in the ORGANIZATION USAGE schema , you must first set the timezone of the session to UTC. Before querying the Account Usage view, execute:Copy\nSection Title: WAREHOUSE_ METERING_ HISTORY view \u00b6 > Examples \u00b6\nContent:\nFor example, to determine the cost of idle time for each warehouse for the last 10 days, execute the following statement:\n```\nSELECT \n  ( SUM ( credits_used_compute ) - \n    SUM ( credits_attributed_compute_queries )) AS idle_cost , \n  warehouse_name \n FROM SNOWFLAKE . ACCOUNT_USAGE . WAREHOUSE_METERING_HISTORY \n WHERE start_time >= DATEADD ( 'days' , - 10 , CURRENT_DATE ()) \n  AND end_time < CURRENT_DATE () \n GROUP BY warehouse_name ;\n```\nCopy\nWas this page helpful?\nYes No\n[Visit Snowflake](https://www.snowflake.com)\n[Join the conversation](https://community.snowflake.com/s/)\n[Develop with Snowflake](https://developers.snowflake.com)\nShare your feedback\n[Read the latest on our blog](https://www.snowflake.com/blog/)\n[Get your own certification](https://learn.snowflake.com)\nOn this page\nColumns\nUsage notes\nExamples\nSection Title: WAREHOUSE_ METERING_ HISTORY view \u00b6 > Privacy Preference Center\nContent:\nYour Opt Out Preference Signal is Honored\nYour Privacy\nStrictly Necessary Cookies\nPerformance Cookies\nFunctional Cookies\nTargeting Cookies\nSection Title: WAREHOUSE_ METERING_ HISTORY view \u00b6 > Privacy Preference Center > Your Privacy\nContent:\nWhen you visit any website, it may store or retrieve information on your browser, mostly in the form of cookies. This information might be about you, your preferences or your device and is mostly used to make the site work as you expect it to. The information does not usually directly identify you, but it can give you a more personalized web experience. Because we respect your right to privacy, you can choose not to allow some types of cookies. Click on the different category headings to find out more and change our default settings. However, blocking some types of cookies may impact your experience of the site and the services we are able to offer.\n[More information](https://cookiepedia.co.uk/giving-consent-to-cookies)\nSection Title: WAREHOUSE_ METERING_ HISTORY view \u00b6 > ... > Your Privacy > Strictly Necessary Cookies\nContent:\nAlways Active\nThese cookies are necessary for the website to function and cannot be switched off. They are usually only set in response to actions made by you which amount to a request for services, such as setting your privacy preferences, logging in or filling in forms. You can set your browser to block or alert you about these cookies, but some parts of the site will not then work. These cookies do not store any personally identifiable information.\nCookies Details\u200e\nSection Title: WAREHOUSE_ METERING_ HISTORY view \u00b6 > Privacy Preference Center > Your Privacy > Performance Cookies\nContent:\nPerformance Cookies\nThese cookies allow us to count visits and traffic sources so we can measure and improve the performance of our site. They help us to know which pages are the most and least popular and see how visitors move around the site.    All information these cookies collect is aggregated and therefore anonymous. If you do not allow these cookies we will not know when you have visited our site, and will not be able to monitor its performance.\nCookies Details\u200e\nSection Title: WAREHOUSE_ METERING_ HISTORY view \u00b6 > Privacy Preference Center > Your Privacy > Functional Cookies\nContent:\nFunctional Cookies\nThese cookies enable the website to provide enhanced functionality and personalisation. They may be set by us or by third party providers whose services we have added to our pages.    If you do not allow these cookies then some or all of these services may not function properly.\nCookies Details\u200e\nSection Title: WAREHOUSE_ METERING_ HISTORY view \u00b6 > Privacy Preference Center > Your Privacy > Targeting Cookies\nContent:\nTargeting Cookies\nThese cookies may be set through our site by our advertising partners. They may be used by those companies to build a profile of your interests and show you relevant adverts on other sites. They do not store directly identifiable personal information, but are based on uniquely identifying your browser and internet device. If you do not allow these cookies, you will experience less targeted advertising.\nCookies Details\u200e\nSection Title: WAREHOUSE_ METERING_ HISTORY view \u00b6 > Privacy Preference Center > Cookie List\nContent:\nConsent Leg.Interest\ncheckbox label label\ncheckbox label label\ncheckbox label label\nClear\ncheckbox label label\nApply Cancel\nConfirm My Choices\nAllow All\n[](https://www.onetrust.com/products/cookie-consent/)"
      ]
    },
    {
      "url": "https://docs.snowflake.com/en/sql-reference/account-usage/metering_history",
      "title": "METERING_HISTORY view - Snowflake Documentation",
      "excerpts": [
        "Reference General reference SNOWFLAKE database Account Usage METERING_HISTORY\nSchemas:\nACCOUNT_USAGE , READER_ACCOUNT_USAGE\nSection Title: METERING_HISTORY view \u00b6\nContent:\nThe METERING_HISTORY view in the ACCOUNT_USAGE schema can be used to return the hourly credit usage for an account within the last 365 days (1 year).\nSection Title: METERING_HISTORY view \u00b6 > Columns \u00b6\nContent:\n| Column Name | Data Type | Description |\n| SERVICE_TYPE | VARCHAR | Type of service that is consuming credits. The following list includes many, **but not all** , of the possible service types: |\nSection Title: METERING_HISTORY view \u00b6 > Columns \u00b6\nContent:\n`AI_SERVICES` : See Snowflake Cortex AI Functions (including LLM functions) , Cortex Analyst , and Document AI . `ARCHIVE_STORAGE_RETRIEVAL_FILE_PROCESSING` : See Billing for storage lifecycle policies . `ARCHIVE_STORAGE_WRITE` : See Billing for storage lifecycle policies . `AUTO_CLUSTERING` : See Automatic Clustering . `BACKUP` : See Backups for disaster recovery and immutable storage . `COPY_FILES` : See COPY FILES . `DATA_QUALITY_MONITORING` : See Introduction to data quality checks . `FAILSAFE_RECOVERY` : See Understanding and viewing Fail-safe . `HYBRID_TABLE_REQUESTS` : See Hybrid tables . `MATERIALIZED_VIEW` : See Working with Materialized Views . `OPENFLOW_COMPUTE_BYOC` : See Openflow BYOC cost and scaling considerations . `OPENFLOW_COMPUTE_SNOWFLAKE` : See Openflow Snowflake Deployment cost and scaling considerations . `PIPE` : See Snowpipe . `POSTGRES_COMPUTE` : See Snowflake Postgres . `POSTGRES_COMPUTE_HA` : See Snowflake Postgres .\nSection Title: METERING_HISTORY view \u00b6 > Columns \u00b6\nContent:\n`QUERY_ACCELERATION` : See Using the Query Acceleration Service (QAS) . `REPLICATION` : See Introduction to replication and failover across multiple accounts . `SEARCH_OPTIMIZATION` : See Search optimization service . `SENSITIVE_DATA_CLASSIFICATION` : See Introduction to sensitive data classification . `SERVERLESS_ALERTS` : See Setting up alerts based on data in Snowflake . `SERVERLESS_TASK` : See Introduction to tasks . `SNOWPARK_CONTAINER_SERVICES` : See Snowpark Container Services . `SNOWPIPE_STREAMING` : See Snowpipe Streaming . `STORAGE_LIFECYCLE_POLICY_EXECUTION` : Compute cost to apply a policy on a target table and expire or archive rows (policy execution). See Storage lifecycle policies . `TELEMETRY_DATA_INGEST` : See Event table overview . `TRUST_CENTER` : See Trust Center . `WAREHOUSE_METERING` : See Overview of warehouses . `WAREHOUSE_METERING_READER` : See Manage reader accounts .\nSection Title: METERING_HISTORY view \u00b6 > Columns \u00b6\nContent:\n|\n|START_TIME |TIMESTAMP_LTZ |The date and beginning of the hour (in the local time zone) in which the usage took place. |\n|END_TIME |TIMESTAMP_LTZ |The date and end of the hour (in the local time zone) in which the usage took place. |\n|ENTITY_ID |NUMBER |A system-generated identifier for the entity associated with the service.\nSection Title: METERING_HISTORY view \u00b6 > Columns \u00b6\nContent:\nIn most cases, this is the internal ID of the monitored entity; for example, a pipe, task, or replication group.\nWhen the SERVICE_TYPE is COPY_FILES, this column shows the ID of the database, schema, or stage from which files are copied.\nIf the SERVICE_TYPE is an Openflow type, the value is NULL.\nIf the SERVICE_TYPE is Snowpipe Streaming, this shows the ID of the relevant pipe; which is the default pipe ID for the default pipe. |\n|ENTITY_TYPE |VARCHAR |Type of Snowflake resource that consumed credits, such as WAREHOUSE, TASK, or TABLE. Note that TABLE is used for all table-like objects. |\n|NAME |VARCHAR |The name of the service or object associated with the cost entry, which varies significantly based on the SERVICE_TYPE.\nStandard (General): This column shows the name of the service type itself; for example, REPLICATION, TASK.\nSNOWPIPE_STREAMING: This service type generates two distinct cost entries, and the NAME column varies for each:\nSection Title: METERING_HISTORY view \u00b6 > Columns \u00b6\nContent:\nCost entry 1 (table name): The value is the name of the Snowflake target table. For the high-performance default pipe, the name is derived from the target table name and appended with -STREAMING; for example, MY_TABLE-STREAMING.\nCost entry 2 (client string): The value is a colon-separated string in the format: SNOWPIPE_STREAMING:CLIENT_NAME:SNOWFLAKE_PROVIDED_ID. This is used for tracking client-side costs.\nCOPY_FILES: The value is the name of the database from which the files are copied.\nSection Title: METERING_HISTORY view \u00b6 > Columns \u00b6\nContent:\nOpenflow Types: The value is NULL. |\n|DATABASE_ID |NUMBER |Internal/system-generated identifier of the database associated with the resource of type `ENTITY_TYPE` . Contains a NULL value when the resource isn\u2019t associated with a specific database; for example, a warehouse or compute pool. |\n|DATABASE_NAME |VARCHAR |Name of the database associated with the resource of type `ENTITY_TYPE` . Contains a NULL value when the resource isn\u2019t associated with a specific database. |\n|SCHEMA_ID |NUMBER |Internal or system-generated identifier of the schema associated with the resource of type `ENTITY_TYPE` . Contains a NULL value when the resource isn\u2019t associated with a specific schema. |\n|SCHEMA_NAME |VARCHAR |Name of the schema associated with the resource of type `ENTITY_TYPE` . Contains a NULL value when the resource isn\u2019t associated with a specific schema.\nSection Title: METERING_HISTORY view \u00b6 > Columns \u00b6\nContent:\n|\n|CREDITS_USED_COMPUTE |NUMBER |Number of credits used by warehouses, serverless compute, and Openflow resources in the hour. |\n|CREDITS_USED_CLOUD_\nSERVICES |NUMBER |Number of credits used for cloud services in the hour. Always `0` when the SERVICE_TYPE is one of the Openflow types. |\n|CREDITS_USED |NUMBER |Total number of credits used for the account in the hour. This is a sum of CREDITS_USED_COMPUTE and CREDITS_USED_CLOUD_SERVICES. This value does not take into account the adjustment for cloud services, and may therefore be greater than your actual credit consumption. |\n|BYTES |NUMBER |When the service type is `auto_clustering` , indicates the number of bytes reclustered during the START_TIME and END_TIME window. When the service type is `pipe` , indicates the number of bytes inserted during the START_TIME and END_TIME window.\nSection Title: METERING_HISTORY view \u00b6 > Columns \u00b6\nContent:\nWhen the service type is `SNOWPIPE_STREAMING` , indicates the number of bytes migrated during the START_TIME and END_TIME window. When the service type is `COPY_FILES` , columns are aggregated at the database level. |\n|ROWS |NUMBER |When the service type is `auto_clustering` , indicates number of rows reclustered during the START_TIME and END_TIME window. When the service type is `SNOWPIPE_STREAMING` , indicates the number of rows migrated during the START_TIME and END_TIME window. |\n|FILES |NUMBER |When the service type is `pipe` , indicates number of files loaded during the START_TIME and END_TIME window. When the service type is `SNOWPIPE_STREAMING` , this is NULL. When the service type is `COPY_FILES` , columns are aggregated at the database level. |\nSection Title: METERING_HISTORY view \u00b6 > Usage notes \u00b6\nContent:\nLatency for the view may be up to 180 minutes (3 hours), except for the CREDITS_USED_CLOUD_SERVICES column. Latency for\nCREDITS_USED_CLOUD_SERVICES may be up to 6 hours.\nLatency for showing the credit consumption of `SNOWPIPE_STREAMING` may be up to 12 hours.\nWas this page helpful?\nYes No\n[Visit Snowflake](https://www.snowflake.com)\n[Join the conversation](https://community.snowflake.com/s/)\n[Develop with Snowflake](https://developers.snowflake.com)\nShare your feedback\n[Read the latest on our blog](https://www.snowflake.com/blog/)\n[Get your own certification](https://learn.snowflake.com)\nOn this page\nColumns\nUsage notes\nSection Title: METERING_HISTORY view \u00b6 > Privacy Preference Center\nContent:\nYour Opt Out Preference Signal is Honored\nYour Privacy\nStrictly Necessary Cookies\nPerformance Cookies\nFunctional Cookies\nTargeting Cookies\nSection Title: METERING_HISTORY view \u00b6 > Privacy Preference Center > Your Privacy\nContent:\nWhen you visit any website, it may store or retrieve information on your browser, mostly in the form of cookies. This information might be about you, your preferences or your device and is mostly used to make the site work as you expect it to. The information does not usually directly identify you, but it can give you a more personalized web experience. Because we respect your right to privacy, you can choose not to allow some types of cookies. Click on the different category headings to find out more and change our default settings. However, blocking some types of cookies may impact your experience of the site and the services we are able to offer.\n[More information](https://cookiepedia.co.uk/giving-consent-to-cookies)\nSection Title: METERING_HISTORY view \u00b6 > Privacy Preference Center > Your Privacy > Strictly Necessary Cookies\nContent:\nAlways Active\nThese cookies are necessary for the website to function and cannot be switched off. They are usually only set in response to actions made by you which amount to a request for services, such as setting your privacy preferences, logging in or filling in forms. You can set your browser to block or alert you about these cookies, but some parts of the site will not then work. These cookies do not store any personally identifiable information.\nCookies Details\u200e\nSection Title: METERING_HISTORY view \u00b6 > Privacy Preference Center > Your Privacy > Performance Cookies\nContent:\nPerformance Cookies\nThese cookies allow us to count visits and traffic sources so we can measure and improve the performance of our site. They help us to know which pages are the most and least popular and see how visitors move around the site.    All information these cookies collect is aggregated and therefore anonymous. If you do not allow these cookies we will not know when you have visited our site, and will not be able to monitor its performance.\nCookies Details\u200e\nSection Title: METERING_HISTORY view \u00b6 > Privacy Preference Center > Your Privacy > Functional Cookies\nContent:\nFunctional Cookies\nThese cookies enable the website to provide enhanced functionality and personalisation. They may be set by us or by third party providers whose services we have added to our pages.    If you do not allow these cookies then some or all of these services may not function properly.\nCookies Details\u200e\nSection Title: METERING_HISTORY view \u00b6 > Privacy Preference Center > Your Privacy > Targeting Cookies\nContent:\nTargeting Cookies\nThese cookies may be set through our site by our advertising partners. They may be used by those companies to build a profile of your interests and show you relevant adverts on other sites. They do not store directly identifiable personal information, but are based on uniquely identifying your browser and internet device. If you do not allow these cookies, you will experience less targeted advertising.\nCookies Details\u200e\nSection Title: METERING_HISTORY view \u00b6 > Privacy Preference Center > Cookie List\nContent:\nConsent Leg.Interest\ncheckbox label label\ncheckbox label label\ncheckbox label label\nClear\ncheckbox label label\nApply Cancel\nConfirm My Choices\nAllow All\n[](https://www.onetrust.com/products/cookie-consent/)"
      ]
    },
    {
      "url": "https://www.snowflake.com/en/developers/guides/resource-optimization-billing-metrics/",
      "title": "Resource Optimization: Billing Metrics - Snowflake",
      "excerpts": [
        "Section Title: Resource Optimization: Billing Metrics\nContent:\nMatt Meredith\n[fork repo](https://github.com/Snowflake-Labs/sfquickstarts/tree/master/site/sfguides/src/resource-optimization-billing-metrics)\nSection Title: Resource Optimization: Billing Metrics > Overview\nContent:\nThis resource optimization guide represents one module of the four contained in the series. These guides are meant to help customers better monitor and manage their credit consumption. Helping our customers build confidence that their credits are being used efficiently is key to an ongoing successful partnership. In addition to this set of Snowflake Quickstarts for Resource Optimization, Snowflake also offers community support as well as Training and Professional Services offerings. To learn more about the paid offerings, take a look at upcoming education and training .\nThis blog post can provide you with a better understanding of Snowflake's Resource Optimization capabilities.\nSection Title: Resource Optimization: Billing Metrics > Overview > Billing Metrics\nContent:\nBilling queries are responsible for identifying total costs associated with the high level functions of the Snowflake Cloud Data Platform, which includes warehouse compute, snowpipe compute, and storage costs. If costs are noticeably higher in one category versus the others, you may want to evaluate what might be causing that.\nThese metrics also seek to identify those queries that are consuming the most amount of credits. From there, each of these queries can be analyze for their importance (do they need to be run as frequently, if at all) and explore if additional controls need to be in place to prevent excessive consumption (i.e. resource monitors, statement timeouts, etc.).\n ... \nSection Title: Resource Optimization: Billing Metrics > Overview > What You\u2019ll Need\nContent:\nA Snowflake Account\nAccess to view [Account Usage Data Share](https://docs.snowflake.com/en/sql-reference/account-usage.html)\nSection Title: Resource Optimization: Billing Metrics > Overview > Related Materials\nContent:\nResource Optimization: Setup & Configuration\nResource Optimization: Usage Monitoring\nResource Optimization: Performance\n ... \nSection Title: Resource Optimization: Billing Metrics > Billing Metrics (T1) > Tier 1 > Description:\nContent:\nIdentify key metrics as it pertains to total compute costs from warehouses,\nserverless features, and total storage costs.\n ... \nSection Title: Resource Optimization: Billing Metrics > Billing Metrics (T1) > Tier 1 > Primary Schema:\nContent:\nAccount_Usage\nSection Title: Resource Optimization: Billing Metrics > Billing Metrics (T1) > Tier 1 > SQL\nContent:\n/* These queries can be used to measure where costs have been incurred by\nthe different cost vectors within a Snowflake account including:\nWarehouse Costs\nServerless Costs\nStorage Costs\nTo accurately report the dollar amounts, make changes to the variables\ndefined on lines 17 to 20 to properly reflect your credit price, the initial\ncapacity purchased, when your contract started and the term (default 12 months)\nIf unsure, ask your Sales Engineer or Account Executive\n*/\nUSE DATABASE SNOWFLAKE;\nUSE SCHEMA ACCOUNT_USAGE;\nSET CREDIT_PRICE = 4.00; --edit this number to reflect credit price\nSET TERM_LENGTH = 12; --integer value in months\nSET TERM_START_DATE = '2019-01-01';\nSET TERM_AMOUNT = 100000.00; --number(10,2) value in dollars\nWITH CONTRACT_VALUES AS (\n ... \nSection Title: Resource Optimization: Billing Metrics > Billing Metrics (T1) > Tier 1 > SQL\nContent:\n--COMPUTE FROM WAREHOUSES\nSELECT\n'WH Compute' as WAREHOUSE_GROUP_NAME\n,WMH.WAREHOUSE_NAME\n,NULL AS GROUP_CONTACT\n,NULL AS GROUP_COST_CENTER\n,NULL AS GROUP_COMMENT\n,WMH.START_TIME\n,WMH.END_TIME\n,WMH.CREDITS_USED\n,$CREDIT_PRICE\n,($CREDIT_PRICE*WMH.CREDITS_USED) AS DOLLARS_USED\n,'ACTUAL COMPUTE' AS MEASURE_TYPE\nfrom    SNOWFLAKE.ACCOUNT_USAGE.WAREHOUSE_METERING_HISTORY WMH\nUNION ALL\n--COMPUTE FROM SNOWPIPE\nSELECT\n'Snowpipe' AS WAREHOUSE_GROUP_NAME\n,PUH.PIPE_NAME AS WAREHOUSE_NAME\n,NULL AS GROUP_CONTACT\n,NULL AS GROUP_COST_CENTER\n,NULL AS GROUP_COMMENT\n,PUH.START_TIME\n,PUH.END_TIME\n,PUH.CREDITS_USED\n,$CREDIT_PRICE\n,($CREDIT_PRICE*PUH.CREDITS_USED) AS DOLLARS_USED\n,'ACTUAL COMPUTE' AS MEASURE_TYPE\nfrom    SNOWFLAKE.ACCOUNT_USAGE.PIPE_USAGE_HISTORY PUH\nUNION ALL\nSection Title: Resource Optimization: Billing Metrics > Billing Metrics (T1) > Tier 1 > SQL\nContent:\n--COMPUTE FROM CLUSTERING\nSELECT\n'Auto Clustering' AS WAREHOUSE_GROUP_NAME\n,DATABASE_NAME || '.' || SCHEMA_NAME || '.' || TABLE_NAME AS WAREHOUSE_NAME\n,NULL AS GROUP_CONTACT\n,NULL AS GROUP_COST_CENTER\n,NULL AS GROUP_COMMENT\n,ACH.START_TIME\n,ACH.END_TIME\n,ACH.CREDITS_USED\n,$CREDIT_PRICE\n,($CREDIT_PRICE*ACH.CREDITS_USED) AS DOLLARS_USED\n,'ACTUAL COMPUTE' AS MEASURE_TYPE\nfrom    SNOWFLAKE.ACCOUNT_USAGE.AUTOMATIC_CLUSTERING_HISTORY ACH\nUNION ALL\n--COMPUTE FROM MATERIALIZED VIEWS\nSELECT\n'Materialized Views' AS WAREHOUSE_GROUP_NAME\n,DATABASE_NAME || '.' || SCHEMA_NAME || '.' || TABLE_NAME AS WAREHOUSE_NAME\n,NULL AS GROUP_CONTACT\n,NULL AS GROUP_COST_CENTER\n,NULL AS GROUP_COMMENT\n,MVH.START_TIME\n,MVH.END_TIME\n,MVH.CREDITS_USED\n,$CREDIT_PRICE\n,($CREDIT_PRICE*MVH.CREDITS_USED) AS DOLLARS_USED\n,'ACTUAL COMPUTE' AS MEASURE_TYPE\nfrom    SNOWFLAKE.ACCOUNT_USAGE.MATERIALIZED_VIEW_REFRESH_HISTORY MVH\nUNION ALL\nSection Title: Resource Optimization: Billing Metrics > Billing Metrics (T1) > Tier 1 > SQL\nContent:\n--COMPUTE FROM SEARCH OPTIMIZATION\nSELECT\n'Search Optimization' AS WAREHOUSE_GROUP_NAME\n,DATABASE_NAME || '.' || SCHEMA_NAME || '.' || TABLE_NAME AS WAREHOUSE_NAME\n,NULL AS GROUP_CONTACT\n,NULL AS GROUP_COST_CENTER\n,NULL AS GROUP_COMMENT\n,SOH.START_TIME\n,SOH.END_TIME\n,SOH.CREDITS_USED\n,$CREDIT_PRICE\n,($CREDIT_PRICE*SOH.CREDITS_USED) AS DOLLARS_USED\n,'ACTUAL COMPUTE' AS MEASURE_TYPE\nfrom    SNOWFLAKE.ACCOUNT_USAGE.SEARCH_OPTIMIZATION_HISTORY SOH\nUNION ALL\n--COMPUTE FROM REPLICATION\nSELECT\n'Replication' AS WAREHOUSE_GROUP_NAME\n,DATABASE_NAME AS WAREHOUSE_NAME\n,NULL AS GROUP_CONTACT\n,NULL AS GROUP_COST_CENTER\n,NULL AS GROUP_COMMENT\n,RUH.START_TIME\n,RUH.END_TIME\n,RUH.CREDITS_USED\n,$CREDIT_PRICE\n,($CREDIT_PRICE*RUH.CREDITS_USED) AS DOLLARS_USED\n,'ACTUAL COMPUTE' AS MEASURE_TYPE\nfrom    SNOWFLAKE.ACCOUNT_USAGE.REPLICATION_USAGE_HISTORY RUH\nUNION ALL\nSection Title: Resource Optimization: Billing Metrics > Billing Metrics (T1) > Tier 1 > SQL\nContent:\n--STORAGE COSTS\nSELECT\n'Storage' AS WAREHOUSE_GROUP_NAME\n,'Storage' AS WAREHOUSE_NAME\n,NULL AS GROUP_CONTACT\n,NULL AS GROUP_COST_CENTER\n,NULL AS GROUP_COMMENT\n,SU.USAGE_DATE\n,SU.USAGE_DATE\n,NULL AS CREDITS_USED\n,$CREDIT_PRICE\n,((STORAGE_BYTES + STAGE_BYTES + FAILSAFE_BYTES)/(1024*1024*1024*1024)*23)/DA.DAYS_IN_MONTH AS DOLLARS_USED\n,'ACTUAL COMPUTE' AS MEASURE_TYPE\nfrom    SNOWFLAKE.ACCOUNT_USAGE.STORAGE_USAGE SU\nJOIN    (SELECT COUNT(*) AS DAYS_IN_MONTH,TO_DATE(DATE_PART('year',D_DATE)||'-'||DATE_PART('month',D_DATE)||'-01') as DATE_MONTH FROM SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM GROUP BY TO_DATE(DATE_PART('year',D_DATE)||'-'||DATE_PART('month',D_DATE)||'-01')) DA ON DA.DATE_MONTH = TO_DATE(DATE_PART('year',USAGE_DATE)||'-'||DATE_PART('month',USAGE_DATE)||'-01')\nUNION ALL\n ... \nSection Title: Resource Optimization: Billing Metrics > Most Expensive Queries (T2) > Tier 2 > Description:\nContent:\nThis query orders the most expensive queries from the last 30 days. It takes into account the warehouse size, assuming that a 1 minute query on larger warehouse is more expensive than a 1 minute query on a smaller warehouse\n ... \nSection Title: Resource Optimization: Billing Metrics > Most Expensive Queries (T2) > Tier 2 > Primary Schema:\nContent:\nAccount_Usage\n ... \nSection Title: Resource Optimization: Billing Metrics > ... > Tier 2 > Description:\nContent:\nThis summarize the query activity and credit consumption per warehouse over the last month. The query also includes the ratio of queries executed to credits consumed on the warehouse\nSection Title: Resource Optimization: Billing Metrics > ... > Tier 2 > How to Interpret Results:\nContent:\nHighlights any scenarios where warehouse consumption is significantly out of line with the number of queries executed. Maybe auto-suspend needs to be adjusted or warehouses need to be consolidated.\nSection Title: Resource Optimization: Billing Metrics > ... > Tier 2 > Primary Schema:\nContent:\nAccount_Usage\nSection Title: Resource Optimization: Billing Metrics > Average Cost per Query by Warehouse (T2) > Tier 2 > SQL\nContent:\nset credit_price = 4;  --edit this value to reflect your credit price\nSELECT\nCOALESCE(WC.WAREHOUSE_NAME,QC.WAREHOUSE_NAME) AS WAREHOUSE_NAME\n,QC.QUERY_COUNT_LAST_MONTH\n,WC.CREDITS_USED_LAST_MONTH\n,WC.CREDIT_COST_LAST_MONTH\n,CAST((WC.CREDIT_COST_LAST_MONTH / QC.QUERY_COUNT_LAST_MONTH) AS decimal(10,2) ) AS COST_PER_QUERY\nFROM (\nSELECT\nWAREHOUSE_NAME\n,COUNT(QUERY_ID) as QUERY_COUNT_LAST_MONTH\nFROM SNOWFLAKE.ACCOUNT_USAGE.QUERY_HISTORY\nWHERE TO_DATE(START_TIME) >= TO_DATE(DATEADD(month,-1,CURRENT_TIMESTAMP()))\nGROUP BY WAREHOUSE_NAME\n) QC\nJOIN (\n```\nSELECT\n    WAREHOUSE_NAME\n    ,SUM(CREDITS_USED) as CREDITS_USED_LAST_MONTH\n    ,SUM(CREDITS_USED)*($CREDIT_PRICE) as CREDIT_COST_LAST_MONTH\nFROM SNOWFLAKE.ACCOUNT_USAGE.WAREHOUSE_METERING_HISTORY\nWHERE TO_DATE(START_TIME) >= TO_DATE(DATEADD(month,-1,CURRENT_TIMESTAMP()))\nGROUP BY WAREHOUSE_NAME\n```\n) WC\nON WC.WAREHOUSE_NAME = QC.WAREHOUSE_NAME\nSection Title: Resource Optimization: Billing Metrics > Average Cost per Query by Warehouse (T2) > Tier 2 > SQL\nContent:\nORDER BY COST_PER_QUERY DESC\n;\n```\n\nCopy\n```\n ... \nSection Title: Resource Optimization: Billing Metrics > ... > Tier 3 > Primary Schema:\nContent:\nAccount_Usage\nSection Title: Resource Optimization: Billing Metrics > ... > Tier 3 > SQL\nContent:\nSELECT TO_DATE(START_TIME) as DATE\n,DATABASE_NAME\n,SCHEMA_NAME\n,TABLE_NAME\n,SUM(CREDITS_USED) as CREDITS_USED\nFROM \"SNOWFLAKE\".\"ACCOUNT_USAGE\".\"AUTOMATIC_CLUSTERING_HISTORY\"\nWHERE START_TIME >= dateadd(month,-1,current_timestamp())\nGROUP BY 1,2,3,4\nORDER BY 5 DESC\n;\n```\n\nCopy\n```\nSection Title: Resource Optimization: Billing Metrics > ... > Tier 3 > Description:\nContent:\nFull list of materialized views and the volume of credits consumed via the service over the last 30 days, broken out by day.\n ... \nSection Title: Resource Optimization: Billing Metrics > ... > Tier 3 > Primary Schema:\nContent:\nAccount_Usage\nSection Title: Resource Optimization: Billing Metrics > ... > Tier 3 > SQL\nContent:\nSELECT\nTO_DATE(START_TIME) as DATE\n,DATABASE_NAME\n,SCHEMA_NAME\n,TABLE_NAME\n,SUM(CREDITS_USED) as CREDITS_USED\nFROM \"SNOWFLAKE\".\"ACCOUNT_USAGE\".\"MATERIALIZED_VIEW_REFRESH_HISTORY\"\nWHERE START_TIME >= dateadd(month,-1,current_timestamp())\nGROUP BY 1,2,3,4\nORDER BY 5 DESC\n;\n```\n\nCopy\n```\n ... \nSection Title: Resource Optimization: Billing Metrics > ... > Tier 3 > Primary Schema:\nContent:\nAccount_Usage\nSection Title: Resource Optimization: Billing Metrics > ... > Tier 3 > SQL\nContent:\nSELECT\nTO_DATE(START_TIME) as DATE\n,DATABASE_NAME\n,SCHEMA_NAME\n,TABLE_NAME\n,SUM(CREDITS_USED) as CREDITS_USED\nFROM \"SNOWFLAKE\".\"ACCOUNT_USAGE\".\"SEARCH_OPTIMIZATION_HISTORY\"\nWHERE START_TIME >= dateadd(month,-1,current_timestamp())\nGROUP BY 1,2,3,4\nORDER BY 5 DESC\n;\n```\n\nCopy\n```\n ... \nSection Title: Resource Optimization: Billing Metrics > ... > Tier 3 > Primary Schema:\nContent:\nAccount_Usage\nSection Title: Resource Optimization: Billing Metrics > ... > Tier 3 > SQL\nContent:\nSELECT\nTO_DATE(START_TIME) as DATE\n,PIPE_NAME\n,SUM(CREDITS_USED) as CREDITS_USED\nFROM \"SNOWFLAKE\".\"ACCOUNT_USAGE\".\"PIPE_USAGE_HISTORY\"\nWHERE START_TIME >= dateadd(month,-1,current_timestamp())\nGROUP BY 1,2\nORDER BY 3 DESC\n;\n```\n\nCopy\n```\n ... \nSection Title: Resource Optimization: Billing Metrics > ... > Tier 3 > Primary Schema:\nContent:\nAccount_Usage\nSection Title: Resource Optimization: Billing Metrics > ... > Tier 3 > SQL\nContent:\nSELECT\nTO_DATE(START_TIME) as DATE\n,DATABASE_NAME\n,SUM(CREDITS_USED) as CREDITS_USED\nFROM \"SNOWFLAKE\".\"ACCOUNT_USAGE\".\"REPLICATION_USAGE_HISTORY\"\nWHERE START_TIME >= dateadd(month,-1,current_timestamp())\nGROUP BY 1,2\nORDER BY 3 DESC\n;\n```\n\nCopy\n```\nUpdated Sep 15, 2023\nThis content is provided as is, and is not maintained on an ongoing basis. It may be out of date with current Snowflake instances\n**Subscribe to our monthly newsletter** Stay up to date on Snowflake\u2019s latest products, expert insights and resources\u2014right in your inbox!\n*\n*"
      ]
    },
    {
      "url": "https://docs.snowflake.com/en/user-guide/cost-exploring-compute",
      "title": "Exploring compute cost | Snowflake Documentation",
      "excerpts": [
        "[DOCUMENTATION](https://docs.snowflake.com)\n/\nGet started\nGuides\nDeveloper\nReference\nRelease notes\nTutorials\n[Status](https://status.snowflake.com)\nOverview\nSnowflake Horizon Catalog\nApplications and tools for connecting to Snowflake\nVirtual warehouses\nDatabases, Tables, & Views\nData types\nData Integration\nSnowflake Openflow\nApache Iceberg\u2122\nApache Iceberg\u2122 Tables\nSnowflake Open Catalog\nData engineering\nData loading\nDynamic Tables\nStreams and Tasks\ndbt Projects on Snowflake\nData Unloading\nStorage Lifecycle Policies\nMigrations\nQueries\nListings\nCollaboration\nSnowflake AI & ML\nSnowflake Postgres\nAlerts & Notifications\nSecurity\nData Governance\nPrivacy\nOrganizations & Accounts\nBusiness continuity & data recovery\nPerformance optimization\nCost & Billing\nGuides Cost & Billing Visibility Exploring cost Exploring compute cost\nSection Title: Exploring compute cost \u00b6\nContent:\nTotal compute cost consists of the overall use of:\nVirtual warehouses (user-managed compute resources)\nServerless features such as Automatic Clustering and Snowpipe that use Snowflake-managed compute resources\nCloud services layer of the Snowflake architecture\nvCPU usage for Openflow BYOC cost and scaling considerations and Openflow Snowflake Deployment cost and scaling considerations .\nSee Openflow components for more information about Openflow components including runtimes.\nThis topic describes how to gain insight into historical compute costs using Snowsight , or by writing queries against views in\nthe ACCOUNT_USAGE and ORGANIZATION_USAGE schemas.\nSnowsight allows you to quickly and easily obtain information about cost from a visual dashboard. Queries against the usage views\nallow you to drill down into cost data and can help generate custom reports and dashboards.\nSection Title: Exploring compute cost \u00b6\nContent:\nIf you need more information about how compute costs are incurred, refer to Understanding compute cost .\nNote\nThe cloud services layer consumes credits, but not all of those credits are actually billed. Usage for cloud services is charged only if\nthe daily consumption of cloud services exceeds 10% of the daily usage of virtual warehouses. Snowsight and a majority of views\nshow the total number of credits consumed by warehouses, serverless features, and cloud services without accounting for this daily\nadjustment to cloud services.\nTo determine how many credits were actually billed for compute costs, run queries against the METERING_DAILY_HISTORY view .\nSection Title: Exploring compute cost \u00b6 > Viewing credit usage \u00b6\nContent:\nAll compute resources (virtual warehouses, serverless, cloud services) consume Snowflake credits. Users can use Snowsight to\nview the overall cost of compute usage for any given day, week, or month.\nTo explore compute cost:\nSwitch to a role with access to cost and usage data .\nIn the navigation menu, select Admin \u00bb Cost management .\nSelect a warehouse to use to view the usage data. Snowflake recommends using an XS warehouse for this purpose.\nSelect Consumption .\nSelect Compute from the Usage Type drop-down.\nFor usage notes related to the Consumption page, see Usage notes .\n ... \nSection Title: Exploring compute cost \u00b6 > Viewing credit usage \u00b6 > Filter by tag \u00b6\nContent:\nSwitch to a role with access to cost and usage data .\nIn the navigation menu, select Admin \u00bb Cost management .\nSelect a warehouse to use to view the usage data. Snowflake recommends using an XS warehouse for this purpose.\nSelect Consumption .\nSelect Compute from the Usage Type drop-down.\nFrom the Tags drop-down, select the tag.\nSelect the value from the list of the tag\u2019s values.\nSelect Apply .\nFor example, you can use the drop-down to select the `COST_CENTER` tag and the `SALES` value to show usage associated with resources\ntagged with `COST_CENTER = SALES` while excluding all other usage from the dashboard.\nYou can also display all resources with a tag regardless of their tag value. Use the drop down to select a\ntag, then choose All instead of a specific value.\nSection Title: Exploring compute cost \u00b6 > Viewing credit usage \u00b6 > View consumption by type, service, or resource \u00b6\nContent:\nWhen viewing the bar graph that displays compute history, you can filter the data By Type , By Service or By Resource .\nBy Type :\nSeparates resource consumption into compute (virtual warehouses and serverless resources) and cloud services. For the purpose\nof this filter, cloud services is separated out from the other types of compute resources.\nBy Service :\nSeparates resource consumption into warehouse consumption and consumption by each serverless feature. For example,\nWAREHOUSE_METERING represents credits consumed by warehouses while PIPE represents credits consumed by the serverless Snowpipe feature.\nCloud services compute is included in warehouse consumption.\nBy Resource :\nSeparates resource consumption by the Snowflake object that consumed credits. For example, each warehouse is represented,\nas is every table that incurred serverless costs.\nSection Title: Exploring compute cost \u00b6 > Querying data for compute cost \u00b6\nContent:\nSnowflake provides two schemas, ORGANIZATION_USAGE and ACCOUNT_USAGE , that contain data related to usage and cost. The ORGANIZATION_USAGE schema provides\ncost information for all of the accounts in the organization while the ACCOUNT_USAGE schema provides similar information for a single\naccount. Views in these schemas provide granular, analytics-ready usage data to build custom reports or dashboards.\nMost views in the ORGANIZATION_USAGE and ACCOUNT_USAGE schemas contain the cost of compute resources in terms of credits consumed. To explore compute cost in currency, rather than credits, write queries against the USAGE_IN_CURRENCY_DAILY view . This view converts credits consumed into cost in currency using the daily\nprice of a credit.\n ... \nSection Title: Exploring compute cost \u00b6 > Querying data for compute cost \u00b6 > General cost views \u00b6\nContent:\n| View | Compute resource | Description | Schema |\n| METERING_DAILY_HISTORY | Warehouses |  |  |\nSection Title: Exploring compute cost \u00b6 > Querying data for compute cost \u00b6 > General cost views \u00b6\nContent:\nServerless\nCloud Services\nOpenflow runtimes |Credits consumed by all compute resources (warehouses, serverless, cloud services and Openflow) in a given day.\nCan be used to determine whether cloud services compute costs were actually billed for a specific day (that is, cloud services credit\nconsumption exceeded 10% of warehouse consumption). |ORGANIZATION_USAGE ACCOUNT_USAGE |\n|METERING_HISTORY |Warehouses\nServerless\nCloud Services\nOpenflow runtimes |Credits consumed by warehouses, cloud services, serverless, and Openflow features on an hourly basis. To see how many credits an individual\nwarehouse is consuming, query the WAREHOUSE_METERING_HISTORY view. |ACCOUNT_USAGE |\n|USAGE_IN_CURRENCY_DAILY |Warehouses\nServerless\nCloud Services |Daily credit consumption by all compute resources along with the cost of that usage in the organization\u2019s currency. |ORGANIZATION_USAGE |\nSection Title: Exploring compute cost \u00b6 > Querying data for compute cost \u00b6 > Feature-specific cost views \u00b6\nContent:\nThe following views that are dedicated to the usage and cost information for a specific feature.\nSection Title: Exploring compute cost \u00b6 > Querying data for compute cost \u00b6 > Feature-specific cost views \u00b6\nContent:\n| View | Compute resource | Description |\n| APPLICATION_DAILY_USAGE_HISTORY | Warehouses |  |\n ... \nSection Title: Exploring compute cost \u00b6 > Querying data for compute cost \u00b6 > Feature-specific cost views \u00b6\nContent:\nCloud Services |Daily credit usage for Snowflake Native Apps in an account within the last 365 days. |\n|ARCHIVE_STORAGE_DATA_\nRETRIEVAL_USAGE_HISTORY |Serverless |Bytes retrieved from archive storage for storage lifecycle policies. See Billing for storage lifecycle policies for more information. |\n|AUTOMATIC_CLUSTERING_HISTORY |Serverless |Credits consumed by automatic clustering. |\n|CATALOG_LINKED_DATABASE_\nUSAGE_HISTORY |Serverless |Credits consumed by catalog-linked databases. |\n|CORTEX_ANALYST_\nUSAGE_HISTORY |Serverless |Credits consumed by Cortex Analyst. |\n|CORTEX_FINE_TUNING_\nUSAGE_HISTORY |Serverless |Credits consumed for Cortex Fine-tuning. |\n|CORTEX_FUNCTIONS_\nQUERY_USAGE_HISTORY |Serverless |Credits consumed to run queries that use Cortex LLM functions. |\n|CORTEX_FUNCTIONS_\nDOCUMENT_PROCESSING_USAGE_HISTORY |Serverless |Credits consumed to process documents with Document AI.\n ... \nSection Title: Exploring compute cost \u00b6 > Querying data for compute cost \u00b6 > Feature-specific cost views \u00b6\nContent:\n|\n|LISTING_AUTO_FULFILLMENT_\nREFRESH_DAILY |Warehouses |Credits used to refresh data fulfilled to other regions by Cross-Cloud Auto-Fulfillment. |\n|LISTING_AUTO_FULFILLMENT_\nUSAGE_HISTORY |Warehouses |Estimated usage associated with fulfilling data products to other regions by using Cross-Cloud Auto-Fulfillment. Refer to the SERVICE_TYPE of REPLICATION. |\n|MATERIALIZED_VIEW_REFRESH_\nHISTORY |Serverless |Credits consumed the refreshing of materialized views. |\n|OPENFLOW_USAGE_HISTORY |Openflow |Credits consumed by Openflow runtimes. This view is available in the ACCOUNT_USAGE schema only. |\n|PIPE_USAGE_HISTORY |Serverless |Credits consumed by Snowpipe. |\n|QUERY_ACCELERATION_HISTORY |Serverless |Credits consumed by the query acceleration service. |\n|QUERY_ATTRIBUTION_HISTORY |Warehouses |Credits consumed per query for warehouse usage.\n ... \nSection Title: Exploring compute cost \u00b6 > Querying data for compute cost \u00b6 > Feature-specific cost views \u00b6\nContent:\nCloud Services |Hourly credit usage of each warehouse, including the cloud services cost associated with using the warehouse. |\nNote\nThe views and table functions of the Snowflake Information Schema also provide usage data related to cost. Though\nthe ACCOUNT_USAGE schema is preferred, the Information Schema can be faster in some circumstances.\nSection Title: Exploring compute cost \u00b6 > Querying data for compute cost \u00b6 > Example queries \u00b6\nContent:\nThe following queries drill-down into data in ACCOUNT_USAGE views to gain insight into compute costs.\nNote\nQueries executed against views in the Account Usage schema can be modified to gain insight into cost for the entire organization by\nusing the corresponding view in the Organization Usage schema. For example, both schemas include a WAREHOUSE_METERING_HISTORY view.\nClick the name of a query below to see the full SQL example.\nCompute for Warehouses :\n* Query: Average hour-by-hour Snowflake spend (across all warehouses) over the past m days\nQuery: Credit consumption by warehouse over specific time period\nQuery: Warehouse usage over m-day average\nQuery: Warehouse cost attribution by query tag .\nQuery: Warehouse cost attribution by user .\nCompute for Cloud Services :\n* Query: Billed cloud services\nSection Title: Exploring compute cost \u00b6 > Querying data for compute cost \u00b6 > Example queries \u00b6\nContent:\nQuery: Total cloud services cost by type of query\nQuery: Cloud services cost for queries of a given type\nQuery: Warehouses with high cloud services usage\nQuery: Cloud services cost sorted by portion of query time\nCompute for Automatic Clustering :\n* Query: Automatic Clustering cost history (by day, by object)\nQuery: Automatic Clustering History & m-day average\nCompute for Search Optimization :\n* Query: Search Optimization cost history (by day, by object)\nQuery: Search Optimization History & m-day average\nCompute for Materialized Views :\n* Query: Materialized Views cost history (by day, by object)\nQuery: Materialized Views History & m-day average\nCompute for Query Acceleration Service :\n* Query: Query Acceleration Service cost by warehouse\nCompute for Snowpipe :\n* Query: Cumulative usage of data ingest (Snowpipe and \u201cCopy\u201d)\n ... \nSection Title: Exploring compute cost \u00b6 > ... > Example queries \u00b6 > Compute for warehouses \u00b6\nContent:\nQuery: Credit consumption by warehouse over specific time period\nThis query shows the total credit consumption for each warehouse over a specific time period. This helps identify warehouses that are\nconsuming more credits than others and specific warehouses that are consuming more credits than anticipated.\n```\n-- Credits used (all time = past year) \n SELECT warehouse_name , \n  SUM ( credits_used_compute ) AS credits_used_compute_sum \n FROM snowflake . account_usage . warehouse_metering_history \n GROUP BY 1 \n ORDER BY 2 DESC ; \n\n -- Credits used (past N days/weeks/months) \n SELECT warehouse_name , \n  SUM ( credits_used_compute ) AS credits_used_compute_sum \n FROM snowflake . account_usage . warehouse_metering_history \n WHERE start_time >= DATEADD ( day , - m , CURRENT_TIMESTAMP ()) \n GROUP BY 1 \n ORDER BY 2 DESC ;\n```\nCopy\nSection Title: Exploring compute cost \u00b6 > ... > Example queries \u00b6 > Compute for warehouses \u00b6\nContent:\nQuery: Warehouse usage over m-day average\nThis query returns the daily average credit consumption grouped by week and warehouse. It can be used to identify anomalies in credit\nconsumption for warehouses across weeks from the past year.\n ... \nSection Title: Exploring compute cost \u00b6 > ... > Example queries \u00b6 > Compute for cloud services \u00b6\nContent:\nQuery: Billed cloud services\nUsage for cloud services is billed only if the daily consumption of cloud\nservices exceeds 10% of the daily usage of virtual warehouses. This query returns how much of cloud services consumption was actually\nbilled for a particular day, ordered by the highest billed amount.\n```\nSELECT \n    usage_date , \n    credits_used_cloud_services , \n    credits_adjustment_cloud_services , \n    credits_used_cloud_services + credits_adjustment_cloud_services AS billed_cloud_services \n FROM snowflake . account_usage . metering_daily_history \n WHERE usage_date >= DATEADD ( month ,- 1 , CURRENT_TIMESTAMP ()) \n    AND credits_used_cloud_services > 0 \n ORDER BY 4 DESC ;\n```\nCopy\nQuery: Total cloud services cost by type of query\nThis query returns the total credits consumed for cloud services by a particular type of query.\n ... \nSection Title: Exploring compute cost \u00b6 > ... > Example queries \u00b6 > Compute for cloud services \u00b6\nContent:\nQuery: Warehouses with high cloud services usage\nThis query shows the warehouses that are not using enough warehouse time to cover the cloud services portion of compute. This provides a\nlaunching point for additional investigation by isolating warehouses with a high ratio of cloud service use (>10% of overall credits).\nInvestigation candidates include issues around cloning, listing files in S3, partner tools, setting session parameters, etc.\n```\nSELECT \n  warehouse_name , \n  SUM ( credits_used ) AS credits_used , \n  SUM ( credits_used_cloud_services ) AS credits_used_cloud_services , \n  SUM ( credits_used_cloud_services )/ SUM ( credits_used ) AS percent_cloud_services \n FROM snowflake . account_usage . warehouse_metering_history \n WHERE TO_DATE ( start_time ) >= DATEADD ( month ,- 1 , CURRENT_TIMESTAMP ()) \n    AND credits_used_cloud_services > 0 \n GROUP BY 1 \n ORDER BY 4 DESC ;\n```\nCopy"
      ]
    },
    {
      "url": "https://community.snowflake.com/s/article/Warehouse-credit-usage-by-userwise",
      "title": "Why is it not recommended to use Account_Usage views to calculate credit consumption for each user?",
      "publish_date": "2023-08-29",
      "excerpts": [
        "Loading\n\u00d7 Sorry to interrupt\nCSS Error\nRefresh\nCREATE ACCOUNT SIGN IN\nKNOWLEDGE BASE ARTICLES\nCan't find what you're looking for? **Ask The Community**\n**Sign Up for snowflake** **communications**\n[Privacy Notice](https://www.snowflake.com/privacy-policy/) | [Site Terms](https://www.snowflake.com/legal/snowflake-community-terms-of-service/) | Cookie Settings | [Do not Share My personal Information](https://www.snowflake.com/privacy-policy/)\n[unsubscribe here](https://info.snowflake.com/2024-Preference-center.html) or customize your communication preferences\n[](https://twitter.com/SnowflakeDB \"Snowflake Twitter\")\n[](https://www.linkedin.com/uas/login?session_redirect=%2Fcompany%2F3653845 \"Snowflake LinkedIn\")\n[](https://www.youtube.com/user/snowflakecomputing \"Snowflake YouTube\")\n[](https://www.facebook.com/snowflakedb/ \"Snowflake Facebook\")\nLoading\nWhy is it not recommended to use Account_Usage views to calculate credit consumption for each user?"
      ]
    },
    {
      "url": "https://www.snowflake.com/en/developers/guides/resource-optimization-usage-monitoring/",
      "title": "Resource Optimization: Usage Monitoring - Snowflake",
      "excerpts": [
        "Section Title: Resource Optimization: Usage Monitoring > Overview\nContent:\nThis resource optimization guide represents one module of the four contained in the series. These guides are meant to help customers better monitor and manage their credit consumption. Helping our customers build confidence that their credits are being used efficiently is key to an ongoing successful partnership. In addition to this set of Snowflake Quickstarts for Resource Optimization, Snowflake also offers community support as well as Training and Professional Services offerings. To learn more about the paid offerings, take a look at upcoming education and training .\nThis blog post can provide you with a better understanding of Snowflake's Resource Optimization capabilities.\nContact our team at marketing@snowflake.com , we appreciate your feedback.\nSection Title: Resource Optimization: Usage Monitoring > Overview > Usage Monitoring\nContent:\nUsage Monitoring queries are designed to identify the warehouses, queries, tools, and users that are responsible for consuming the most credits over a specified period of time. These queries can be used to determine which of those resources are consuming more credits than anticipated and take the necessary steps to reduce their consumption.\nSection Title: Resource Optimization: Usage Monitoring > Overview > What You\u2019ll Learn\nContent:\nhow to analyze consumption trends and patterns\nhow to identify consumption anomolies\nhow to analyze partner tool consumption metrics\nSection Title: Resource Optimization: Usage Monitoring > Overview > What You\u2019ll Need\nContent:\nA Snowflake Account\nAccess to view [Account Usage Data Share](https://docs.snowflake.com/en/sql-reference/account-usage.html)\nSection Title: Resource Optimization: Usage Monitoring > Overview > Related Materials\nContent:\nResource Optimization: Setup & Configuration\nResource Optimization: Billing Metrics\nResource Optimization: Performance\n ... \nSection Title: Resource Optimization: Usage Monitoring > ... > Tier 1 > How to Interpret Results:\nContent:\nAre there specific warehouses that are consuming more credits than the others? Should they be? Are there specific warehouses that are consuming more credits than anticipated for that warehouse?\nSection Title: Resource Optimization: Usage Monitoring > ... > Tier 1 > Primary Schema:\nContent:\nAccount_Usage\nSection Title: Resource Optimization: Usage Monitoring > Credit Consumption by Warehouse (T1) > Tier 1 > SQL\nContent:\n// Credits used (all time = past year)\nSELECT WAREHOUSE_NAME\n,SUM(CREDITS_USED_COMPUTE) AS CREDITS_USED_COMPUTE_SUM\nFROM ACCOUNT_USAGE.WAREHOUSE_METERING_HISTORY\nGROUP BY 1\nORDER BY 2 DESC\n;\n// Credits used (past N days/weeks/months)\nSELECT WAREHOUSE_NAME\n,SUM(CREDITS_USED_COMPUTE) AS CREDITS_USED_COMPUTE_SUM\nFROM ACCOUNT_USAGE.WAREHOUSE_METERING_HISTORY\nWHERE START_TIME >= DATEADD(DAY, -7, CURRENT_TIMESTAMP())  // Past 7 days\nGROUP BY 1\nORDER BY 2 DESC\n;\n```\n\nCopy\n```\n ... \nSection Title: Resource Optimization: Usage Monitoring > ... > Tier 1 > Primary Schema:\nContent:\nAccount_Usage\nSection Title: Resource Optimization: Usage Monitoring > ... > Tier 1 > SQL (by hour, warehouse)\nContent:\n// Credits used by [hour, warehouse] (past 7 days)\nSELECT START_TIME\n,WAREHOUSE_NAME\n,CREDITS_USED_COMPUTE\nFROM SNOWFLAKE.ACCOUNT_USAGE.WAREHOUSE_METERING_HISTORY\nWHERE START_TIME >= DATEADD(DAY, -7, CURRENT_TIMESTAMP())\nAND WAREHOUSE_ID > 0  // Skip pseudo-VWs such as \"CLOUD_SERVICES_ONLY\"\nORDER BY 1 DESC,2\n;\n```\n\nCopy\n```\n ... \nSection Title: Resource Optimization: Usage Monitoring > ... > Tier 1 > Primary Schema:\nContent:\nAccount_Usage\n ... \nSection Title: Resource Optimization: Usage Monitoring > ... > Tier 1 > Primary Schema:\nContent:\nAccount_Usage\n ... \nSection Title: Resource Optimization: Usage Monitoring > Forecasting Usage/Billing (T1) > Tier 1 > Description:\nContent:\nThis query provides three distinct consumption metrics for each day of the contract term. (1) the contracted consumption is the dollar amount consumed if usage was flat for the entire term. (2) the actual consumption pulls from the various usage views and aggregates dollars at a day level. (3) the forecasted consumption creates a straight line regression from the actuals to project go-forward consumption.\n ... \nSection Title: Resource Optimization: Usage Monitoring > Forecasting Usage/Billing (T1) > Tier 1 > Primary Schema:\nContent:\nAccount_Usage\n ... \nSection Title: Resource Optimization: Usage Monitoring > Forecasting Usage/Billing (T1) > Tier 1 > SQL\nContent:\nCONSUMPTION_DATE\n,SUM(DOLLARS_USED) as ACTUAL_DOLLARS_USED\nFROM (\n--COMPUTE FROM WAREHOUSES\nSELECT\n'WH Compute' as WAREHOUSE_GROUP_NAME\n,WMH.WAREHOUSE_NAME\n,NULL AS GROUP_CONTACT\n,NULL AS GROUP_COST_CENTER\n,NULL AS GROUP_COMMENT\n,WMH.START_TIME\n,WMH.END_TIME\n,WMH.CREDITS_USED\n,$CREDIT_PRICE\n,($CREDIT_PRICE*WMH.CREDITS_USED) AS DOLLARS_USED\n,'ACTUAL COMPUTE' AS MEASURE_TYPE\nfrom    SNOWFLAKE.ACCOUNT_USAGE.WAREHOUSE_METERING_HISTORY WMH\nUNION ALL\n--COMPUTE FROM SNOWPIPE\nSELECT\n'Snowpipe' AS WAREHOUSE_GROUP_NAME\n,PUH.PIPE_NAME AS WAREHOUSE_NAME\n,NULL AS GROUP_CONTACT\n,NULL AS GROUP_COST_CENTER\n,NULL AS GROUP_COMMENT\n,PUH.START_TIME\n,PUH.END_TIME\n,PUH.CREDITS_USED\n,$CREDIT_PRICE\n,($CREDIT_PRICE*PUH.CREDITS_USED) AS DOLLARS_USED\n,'ACTUAL COMPUTE' AS MEASURE_TYPE\nfrom    SNOWFLAKE.ACCOUNT_USAGE.PIPE_USAGE_HISTORY PUH\nUNION ALL\n--COMPUTE FROM CLUSTERING\nSELECT\n'Auto Clustering' AS\nSection Title: Resource Optimization: Usage Monitoring > Forecasting Usage/Billing (T1) > Tier 1 > SQL\nContent:\nWAREHOUSE_GROUP_NAME\n,DATABASE_NAME || '.' || SCHEMA_NAME || '.' || TABLE_NAME AS WAREHOUSE_NAME\n,NULL AS GROUP_CONTACT\n,NULL AS GROUP_COST_CENTER\n,NULL AS GROUP_COMMENT\n,ACH.START_TIME\n,ACH.END_TIME\n,ACH.CREDITS_USED\n,$CREDIT_PRICE\n,($CREDIT_PRICE*ACH.CREDITS_USED) AS DOLLARS_USED\n,'ACTUAL COMPUTE' AS MEASURE_TYPE\nfrom    SNOWFLAKE.ACCOUNT_USAGE.AUTOMATIC_CLUSTERING_HISTORY ACH\nUNION ALL\n--COMPUTE FROM MATERIALIZED VIEWS\nSELECT\n'Materialized Views' AS WAREHOUSE_GROUP_NAME\n,DATABASE_NAME || '.' || SCHEMA_NAME || '.'\nSection Title: Resource Optimization: Usage Monitoring > Forecasting Usage/Billing (T1) > Tier 1 > SQL\nContent:\n|| TABLE_NAME AS WAREHOUSE_NAME\n,NULL AS GROUP_CONTACT\n,NULL AS GROUP_COST_CENTER\n,NULL AS GROUP_COMMENT\n,MVH.START_TIME\n,MVH.END_TIME\n,MVH.CREDITS_USED\n,$CREDIT_PRICE\n,($CREDIT_PRICE*MVH.CREDITS_USED) AS DOLLARS_USED\n,'ACTUAL COMPUTE' AS MEASURE_TYPE\nfrom    SNOWFLAKE.ACCOUNT_USAGE.MATERIALIZED_VIEW_REFRESH_HISTORY MVH\nUNION ALL\n--COMPUTE FROM SEARCH OPTIMIZATION\nSELECT\n'Search Optimization' AS WAREHOUSE_GROUP_NAME\n,DATABASE_NAME || '.' || SCHEMA_NAME || '.'\nSection Title: Resource Optimization: Usage Monitoring > Forecasting Usage/Billing (T1) > Tier 1 > SQL\nContent:\n|| TABLE_NAME AS WAREHOUSE_NAME\n,NULL AS GROUP_CONTACT\n,NULL AS GROUP_COST_CENTER\n,NULL AS GROUP_COMMENT\n,SOH.START_TIME\n,SOH.END_TIME\n,SOH.CREDITS_USED\n,$CREDIT_PRICE\n,($CREDIT_PRICE*SOH.CREDITS_USED) AS DOLLARS_USED\n,'ACTUAL COMPUTE' AS MEASURE_TYPE\nfrom    SNOWFLAKE.ACCOUNT_USAGE.SEARCH_OPTIMIZATION_HISTORY SOH\nUNION ALL\n--COMPUTE FROM REPLICATION\nSELECT\n'Replication' AS WAREHOUSE_GROUP_NAME\n,DATABASE_NAME AS WAREHOUSE_NAME\n,NULL AS GROUP_CONTACT\n,NULL AS GROUP_COST_CENTER\n,NULL AS GROUP_COMMENT\n,RUH.START_TIME\n,RUH.END_TIME\n,RUH.CREDITS_USED\n,$CREDIT_PRICE\n,($CREDIT_PRICE*RUH.CREDITS_USED) AS DOLLARS_USED\n,'ACTUAL COMPUTE' AS MEASURE_TYPE\nfrom    SNOWFLAKE.ACCOUNT_USAGE.REPLICATION_USAGE_HISTORY RUH\nUNION ALL\nSection Title: Resource Optimization: Usage Monitoring > Forecasting Usage/Billing (T1) > Tier 1 > SQL\nContent:\n--STORAGE COSTS\nSELECT\n'Storage' AS WAREHOUSE_GROUP_NAME\n,'Storage' AS WAREHOUSE_NAME\n,NULL AS GROUP_CONTACT\n,NULL AS GROUP_COST_CENTER\n,NULL AS GROUP_COMMENT\n,SU.USAGE_DATE\n,SU.USAGE_DATE\n,NULL AS CREDITS_USED\n,$CREDIT_PRICE\n,((STORAGE_BYTES + STAGE_BYTES + FAILSAFE_BYTES)/(1024*1024*1024*1024)*23)/DA.DAYS_IN_MONTH AS DOLLARS_USED\n,'ACTUAL COMPUTE' AS MEASURE_TYPE\nfrom    SNOWFLAKE.ACCOUNT_USAGE.STORAGE_USAGE SU\nJOIN    (SELECT COUNT(*) AS DAYS_IN_MONTH,TO_DATE(DATE_PART('year',D_DATE)||'-'||DATE_PART('month',D_DATE)||'-01') as DATE_MONTH FROM SNOWFLAKE_SAMPLE_DATA.TPCDS_SF10TCL.DATE_DIM GROUP BY TO_DATE(DATE_PART('year',D_DATE)||'-'||DATE_PART('month',D_DATE)||'-01')) DA ON DA.DATE_MONTH = TO_DATE(DATE_PART('year',USAGE_DATE)||'-'||DATE_PART('month',USAGE_DATE)||'-01')\n) A\ngroup by 1\n),\nFORECASTED_USAGE_SLOPE_INTERCEPT as\n ... \nSection Title: Resource Optimization: Usage Monitoring > Forecasting Usage/Billing (T1) > Tier 1 > SQL\nContent:\nACTUAL_USAGE                                    AU ON AU.CONSUMPTION_DATE = TO_DATE(DA.D_DATE)\nJOIN        FORECASTED_USAGE_SLOPE_INTERCEPT                FU ON 1 = 1\n;\nSection Title: Resource Optimization: Usage Monitoring > Forecasting Usage/Billing (T1) > Tier 1 > SQL\nContent:\n```\n\nCopy\n```\n ... \nSection Title: Resource Optimization: Usage Monitoring > ... > Tier 1 > Primary Schema:\nContent:\nAccount_Usage\n ... \nSection Title: Resource Optimization: Usage Monitoring > ... > Tier 2 > Primary Schema:\nContent:\nAccount_Usage\n ... \nSection Title: Resource Optimization: Usage Monitoring > ... > Tier 2 > Primary Schema:\nContent:\nAccount_Usage\n ... \nSection Title: Resource Optimization: Usage Monitoring > ... > Tier 2 > Primary Schema:\nContent:\nAccount_Usage\n ... \nSection Title: Resource Optimization: Usage Monitoring > ... > Tier 2 > How to Interpret Results:\nContent:\nThis is an opportunity to identify query SLA trends and make a decision to downsize a warehouse, upsize a warehouse, or separate out some queries to another warehouse\nSection Title: Resource Optimization: Usage Monitoring > ... > Tier 2 > Primary Schema:\nContent:\nAccount_Usage\n ... \nSection Title: Resource Optimization: Usage Monitoring > Warehouse Utilization (T2) > Tier 2 > Primary Schema:\nContent:\nAccount_Usage\nSection Title: Resource Optimization: Usage Monitoring > Warehouse Utilization (T2) > Tier 2 > SQL\nContent:\nSELECT\nWMH.WAREHOUSE_NAME\n,WMH.START_TIME\n,WMH.CREDITS_USED\n,SUM(COALESCE(B.EXECUTION_TIME_SECONDS,0)) as TOTAL_EXECUTION_TIME_SECONDS\n,SUM(COALESCE(QUERY_COUNT,0)) AS QUERY_COUNT\nFROM SNOWFLAKE.ACCOUNT_USAGE.WAREHOUSE_METERING_HISTORY WMH\nLEFT JOIN (\nSection Title: Resource Optimization: Usage Monitoring > Warehouse Utilization (T2) > Tier 2 > SQL\nContent:\n```\n  --QUERIES FULLY EXECUTED WITHIN THE HOUR\n  SELECT\n     WMH.WAREHOUSE_NAME\n    ,WMH.START_TIME\n    ,SUM(COALESCE(QH.EXECUTION_TIME,0))/(1000) AS EXECUTION_TIME_SECONDS\n    ,COUNT(DISTINCT QH.QUERY_ID) AS QUERY_COUNT\n  FROM SNOWFLAKE.ACCOUNT_USAGE.WAREHOUSE_METERING_HISTORY     WMH\n  JOIN SNOWFLAKE.ACCOUNT_USAGE.QUERY_HISTORY             QH ON QH.WAREHOUSE_NAME = WMH.WAREHOUSE_NAME\n                                                                      AND QH.START_TIME BETWEEN WMH.START_TIME AND WMH.END_TIME\n                                                                      AND QH.END_TIME BETWEEN WMH.START_TIME AND WMH.END_TIME\n  WHERE TO_DATE(WMH.START_TIME) >= DATEADD(week,-1,CURRENT_TIMESTAMP())\n  AND TO_DATE(QH.START_TIME) >= DATEADD(week,-1,CURRENT_TIMESTAMP())\n  GROUP BY\n  WMH.WAREHOUSE_NAME\n  ,WMH.START_TIME\n\n  UNION ALL\n\n  --FRONT part OF QUERIES Executed longer than 1 Hour\n  SELECT\nSection Title: Resource Optimization: Usage Monitoring > Warehouse Utilization (T2) > Tier 2 > SQL\nContent:\nWMH.WAREHOUSE_NAME\n    ,WMH.START_TIME\n    ,SUM(COALESCE(DATEDIFF(seconds,QH.START_TIME,WMH.END_TIME),0)) AS EXECUTION_TIME_SECONDS\n    ,COUNT(DISTINCT QUERY_ID) AS QUERY_COUNT\n  FROM SNOWFLAKE.ACCOUNT_USAGE.WAREHOUSE_METERING_HISTORY     WMH\n  JOIN SNOWFLAKE.ACCOUNT_USAGE.QUERY_HISTORY             QH ON QH.WAREHOUSE_NAME = WMH.WAREHOUSE_NAME\n                                                                      AND QH.START_TIME BETWEEN WMH.START_TIME AND WMH.END_TIME\n                                                                      AND QH.END_TIME > WMH.END_TIME\n  WHERE TO_DATE(WMH.START_TIME) >= DATEADD(week,-1,CURRENT_TIMESTAMP())\n  AND TO_DATE(QH.START_TIME) >= DATEADD(week,-1,CURRENT_TIMESTAMP())\n  GROUP BY\n  WMH.WAREHOUSE_NAME\n  ,WMH.START_TIME\n\n  UNION ALL\n\n  --Back part OF QUERIES Executed longer than 1 Hour\n  SELECT\n     WMH.WAREHOUSE_NAME\n    ,WMH.START_TIME\nSection Title: Resource Optimization: Usage Monitoring > Warehouse Utilization (T2) > Tier 2 > SQL\nContent:\n,SUM(COALESCE(DATEDIFF(seconds,WMH.START_TIME,QH.END_TIME),0)) AS EXECUTION_TIME_SECONDS\n    ,COUNT(DISTINCT QUERY_ID) AS QUERY_COUNT\n  FROM SNOWFLAKE.ACCOUNT_USAGE.WAREHOUSE_METERING_HISTORY     WMH\n  JOIN SNOWFLAKE.ACCOUNT_USAGE.QUERY_HISTORY             QH ON QH.WAREHOUSE_NAME = WMH.WAREHOUSE_NAME\n                                                                      AND QH.END_TIME BETWEEN WMH.START_TIME AND WMH.END_TIME\n                                                                      AND QH.START_TIME < WMH.START_TIME\n  WHERE TO_DATE(WMH.START_TIME) >= DATEADD(week,-1,CURRENT_TIMESTAMP())\n  AND TO_DATE(QH.START_TIME) >= DATEADD(week,-1,CURRENT_TIMESTAMP())\n  GROUP BY\n  WMH.WAREHOUSE_NAME\n  ,WMH.START_TIME\n\n  UNION ALL\n\n  --Middle part OF QUERIES Executed longer than 1 Hour\n  SELECT\n     WMH.WAREHOUSE_NAME\n    ,WMH.START_TIME\n    ,SUM(COALESCE(DATEDIFF(seconds,WMH.START_TIME,WMH.END_TIME),0)) AS\nSection Title: Resource Optimization: Usage Monitoring > Warehouse Utilization (T2) > Tier 2 > SQL\nContent:\nEXECUTION_TIME_SECONDS\n    ,COUNT(DISTINCT QUERY_ID) AS QUERY_COUNT\n  FROM SNOWFLAKE.ACCOUNT_USAGE.WAREHOUSE_METERING_HISTORY     WMH\n  JOIN SNOWFLAKE.ACCOUNT_USAGE.QUERY_HISTORY             QH ON QH.WAREHOUSE_NAME = WMH.WAREHOUSE_NAME\n                                                                      AND WMH.START_TIME > QH.START_TIME\n                                                                      AND WMH.END_TIME < QH.END_TIME\n  WHERE TO_DATE(WMH.START_TIME) >= DATEADD(week,-1,CURRENT_TIMESTAMP())\n  AND TO_DATE(QH.START_TIME) >= DATEADD(week,-1,CURRENT_TIMESTAMP())\n  GROUP BY\n  WMH.WAREHOUSE_NAME\n  ,WMH.START_TIME\n```"
      ]
    }
  ],
  "usage": [
    {
      "name": "sku_search",
      "count": 1
    }
  ]
}
